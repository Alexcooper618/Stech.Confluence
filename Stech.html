<div id="stech-root" class="stech-page">
  <!-- HEADER –° –ù–û–í–û–°–¢–Ø–ú–ò + —Ü–∏—Ñ—Ä–æ–≤—ã–µ —á–∞—Å—ã -->
  <section class="stech-hero">
    <!-- –õ–µ–≤—ã–π –±–ª–æ–∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞ -->
    <div class="stech-hero__left">
      <h1 class="stech-hero__title">
        <span class="stech-hero__brand">Sminex.tech</span>
      </h1>
      <p class="stech-hero__subtitle">
        –ú—ã —Ä–∞–∑–≤–∏–≤–∞–µ–º —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏ Sminex
      </p>

      <!-- –¶–∏—Ñ—Ä–æ–≤—ã–µ —á–∞—Å—ã -->
      <div class="stech-clock" id="digital-clock">
        <div id="clock-date" class="stech-clock__date"></div>
        <div class="stech-clock__time">
          <span id="clock-hours"></span>
          <span id="clock-colon" class="stech-clock__colon">:</span>
          <span id="clock-minutes"></span>
        </div>
      </div>
    </div>

    <!-- –ë–ª–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π —Å–ø—Ä–∞–≤–∞ -->
    <div class="stech-hero__news">
      <div class="stech-hero__news-title">
        <h3><span>üì¢</span> –ù–æ–≤–æ—Å—Ç–∏ –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ IT</h3>
      </div>

      <div class="stech-hero__news-slider">
        <div class="header-news-slider">
          <!-- –ù–æ–≤–æ—Å—Ç—å: Worklogs –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ -->
          <a href="https://wiki.sminex.com/display/SMTE/Worklogs+1.1" target="_blank" class="header-news-card">
            <p>Worklogs</p>
            <span>–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</span>
          </a>

          <!-- –ù–æ–≤–æ—Å—Ç—å: –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ -->
          <a href="https://wiki.sminex.com/pages/viewpage.action?pageId=197425644" target="_blank" class="header-news-card">
            <p>–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</p>
            <span>–ù–æ–≤—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ IT-–∫–æ–º–∞–Ω–¥ Sminex</span>
          </a>

          <!-- –ù–æ–≤–æ—Å—Ç—å: PlayBook -->
          <a href="https://wiki.sminex.com/display/SMTE/PlayBook+Sminex+Tech" target="_blank" class="header-news-card">
            <p>PlayBook</p>
            <span>–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –¥–∏–∑–∞–π–Ω –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è</span>
          </a>
        </div>
      </div>

      <div class="news-dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
    </div>
  </section>

  <style>
    #stech-root {
      font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #1d1d1f;
    }

    .stech-hero {
      width: 100%;
      text-align: center;
      padding: 30px 24px;
      background: linear-gradient(180deg, #ffffff 0%, #f2f2f3 100%);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: clamp(24px, 3vw, 60px);
      box-sizing: border-box;
      max-width: 1200px;
      margin: 0 auto;
      flex-wrap: wrap;
    }

    .stech-hero__left {
      flex: 1 1 320px;
      text-align: left;
      max-width: 720px;
    }

    .stech-hero__title {
      font-size: clamp(34px, 4vw, 48px);
      font-weight: 600;
      margin-bottom: 16px;
      letter-spacing: -0.5px;
      line-height: 1.2;
    }

    .stech-hero__brand {
      background: linear-gradient(90deg, #007AFF, #1D1D1F);
      -webkit-background-clip: text;
      color: transparent;
    }

    .stech-hero__subtitle {
      font-size: 18px;
      color: #6e6e73;
      max-width: 600px;
      margin: 0;
    }

    .stech-clock {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      margin-top: 20px;
      font-family: 'Courier New', Courier, monospace;
      font-weight: 700;
      font-size: 22px;
      color: #007AFF;
      flex-wrap: wrap;
    }

    .stech-clock__date {
      background: rgba(0, 122, 255, 0.1);
      padding: 4px 10px;
      border-radius: 8px;
    }

    .stech-clock__time {
      display: flex;
      align-items: center;
      gap: 4px;
      background: rgba(0, 122, 255, 0.1);
      padding: 4px 12px;
      border-radius: 12px;
    }

    .stech-clock__colon {
      animation: stech-blink 3s infinite;
    }

    .stech-hero__news {
      flex: 1 1 360px;
      position: relative;
      max-width: 520px;
      min-width: 320px;
    }

    .stech-hero__news-title {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 22px;
    }

    .stech-hero__news-title h3 {
      font-size: 22px;
      font-weight: 600;
      color: #1d1d1f;
      margin: 0;
    }

    .stech-hero__news-slider {
      position: relative;
      height: 180px;
      border-radius: 20px;
      overflow: hidden;
      background: #fff;
    }

    .header-news-slider {
      position: absolute;
      inset: 0;
    }

    .header-news-card {
      position: absolute;
      inset: 0;
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
      text-align: left;
      color: #1d1d1f;
      opacity: 0;
      transform: translateX(30px);
      transition: all 0.8s ease;
      pointer-events: none;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .header-news-card p {
      font-weight: 600;
      margin: 0;
      font-size: 16px;
    }

    .header-news-card span {
      color: #6e6e73;
      font-size: 15px;
    }

    .header-news-card.active {
      opacity: 1;
      transform: translateX(0);
      pointer-events: auto;
    }

    .news-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 16px;
    }

    .news-dots .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #d0d0d0;
      transition: all 0.3s;
    }

    .news-dots .dot.active {
      background: #007AFF;
      width: 16px;
      border-radius: 6px;
    }

    @keyframes stech-blink {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0; }
    }

    @media (max-width: 980px) {
      .stech-hero {
        padding: 24px 16px;
      }
      .stech-hero__news {
        max-width: none;
      }
    }
  </style>

  <script>
    (function initStechHero() {
      const root = document.getElementById('stech-root');
      if (!root) return;

      const headerCards = root.querySelectorAll('.header-news-card');
      const dots = root.querySelectorAll('.news-dots .dot');
      const dateEl = root.querySelector('#clock-date');
      const hoursEl = root.querySelector('#clock-hours');
      const minutesEl = root.querySelector('#clock-minutes');
      if (!headerCards.length || !dots.length || !dateEl || !hoursEl || !minutesEl) return;

      let headerIndex = 0;

      function showHeaderCard() {
        headerCards.forEach(card => card.classList.remove('active'));
        dots.forEach(dot => dot.classList.remove('active'));
        headerCards[headerIndex].classList.add('active');
        dots[headerIndex].classList.add('active');
        headerIndex = (headerIndex + 1) % headerCards.length;
      }

      function updateDigitalClock() {
        const now = new Date();
        dateEl.textContent = now.toLocaleDateString('ru-RU');
        hoursEl.textContent = String(now.getHours()).padStart(2, '0');
        minutesEl.textContent = String(now.getMinutes()).padStart(2, '0');
      }

      showHeaderCard();
      updateDigitalClock();
      setInterval(showHeaderCard, 6000);
      setInterval(updateDigitalClock, 60000);
    })();
  </script>
<!-- === LINEAR STYLE CHANGELOG (c –±–µ–π–¥–∂–µ–º "–Ω–æ–≤–æ–µ") === -->
<div class="changelog">

  <h2 class="changelog-header">–û–±–Ω–æ–≤–ª–µ–Ω–∏—è Sminex.tech</h2>

  <div class="changelog-list">

  <div class="changelog-entry" data-date="2025-11-12">
      <div class="entry-date">02 –¥–µ–∫ 2025</div>
      <div class="entry-content">
        <div class="entry-title">Worklogs</div>
        <p>–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø—É–Ω–∫—Ç—ã –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.</p>
        <a href="https://wiki.sminex.com/display/SMTE/Worklogs+1.1">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>
¬† ¬† ¬† </div>
    </div> 

   <div class="changelog-entry" data-date="2025-11-12">
      <div class="entry-date">01 –¥–µ–∫ 2025</div>
      <div class="entry-content">
        <div class="entry-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</div>
        <p>–ó–∞–ø—É—â–µ–Ω —Å–±–æ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞ –Ω–æ—è–±—Ä—å.</p>
        <a href="http://w1031:8000/session/1">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>
¬† ¬† ¬† </div>
    </div>  

¬† ¬† ¬†<div class="changelog-entry" data-date="2025-11-12">
      <div class="entry-date">11 –Ω–æ—è 2025</div>
      <div class="entry-content">
        <div class="entry-title">BIM –Ω–∞ —Å—Ç—Ä–æ–π–∫–µ</div>
        <p>Sminex –ø–æ–¥–µ–ª–∏–ª—Å—è –æ–ø—ã—Ç–æ–º –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –Ω–∞ —Ñ–æ—Ä—É–º–µ 100+ TechnoBuild.</p>
        <a href="https://habr.com/ru/companies/sminex_developer/news/965348/">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>
¬† ¬† ¬† </div>
    </div> 
 ¬†
  <div class="changelog-entry" data-date="2025-11-12">
      <div class="entry-date">11 –Ω–æ—è 2025</div>
      <div class="entry-content">
        <div class="entry-title">Worklogs 1.1</div>
        <p>–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤–æ—Ä–∫–ª–æ–≥–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.</p>
        <a href="https://wiki.sminex.com/display/SMTE/Worklogs+1.1">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>
¬† ¬† ¬† </div>
    </div>

    <div class="changelog-entry" data-date="2025-11-06">
      <div class="entry-date">06 –Ω–æ—è 2025</div>
      <div class="entry-content">
        <div class="entry-title">–ü–æ–¥–∫–∞—Å—Ç ¬´–ë–µ—Ç–æ–Ω –∏ –¶–∏—Ñ—Ä–∞¬ª</div>
        <p>–ü–∞–≤–µ–ª –û—Å–∏–ø–æ–≤ —Ä–∞—Å—Å–∫–∞–∑–∞–ª –Ω–∞ —Ñ–æ—Ä—É–º–µ ¬´–°–∏–ª–∞ –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã¬ª –æ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ LLM-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ.</p>
        <a href="https://habr.com/ru/companies/sminex_developer/news/963638/" class="entry-link">–ß–∏—Ç–∞—Ç—å –Ω–∞ –•–∞–±—Ä–µ ‚Üí</a>
      </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–µ -->
     <div class="changelog-entry hidden" data-date="2025-11-05">
      <div class="entry-date">05 –Ω–æ—è 2025</div>
      <div class="entry-content">
        <div class="entry-title">üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–∫—Ç—è–±—Ä—è</div>
        <p>–ó–∞–≤–µ—Ä—à–µ–Ω —Å–±–æ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–º–∞–Ω–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.</p>
      </div>
    </div>

    <div class="changelog-entry hidden" data-date="2025-10-22">
      <div class="entry-date">01 –Ω–æ—è 2025</div>
      <div class="entry-content">
        <div class="entry-title">¬´BIM –ü—Ä–æ—Å–≤–µ—Ç 2.0¬ª</div>
        <p>Sminex –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª –∫–µ–π—Å –ø–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–º—É –≤–Ω–µ–¥—Ä–µ–Ω–∏—é LLM –Ω–∞ —Ñ–æ—Ä—É–º–µ ¬´–°–ò–õ–ê –ü–õ–ê–¢–§–û–†–ú–´¬ª.</p>
        <a href="https://habr.com/ru/companies/sminex_developer/news/962334/" class="entry-link">–ß–∏—Ç–∞—Ç—å –Ω–∞ –•–∞–±—Ä–µ ‚Üí</a> 
¬† ¬† ¬† </div>
    </div>

    <div class="changelog-entry hidden" data-date="2025-10-14">
      <div class="entry-date">30 –æ–∫—Ç 2025</div>
      <div class="entry-content">
        <div class="entry-title">–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</div>
        <p>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.</p>
        <a href="https://wiki.sminex.com/pages/viewpage.action?pageId=197425644" class="entry-link">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>  
¬† ¬† ¬† </div>
    </div> 

¬† ¬† <div class="changelog-entry hidden" data-date="2025-10-09">
      <div class="entry-date">10 –æ–∫—Ç 2025</div>
      <div class="entry-content">
        <div class="entry-title">–†–µ–ª–∏–∑ PlayBook</div>
        <p>–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω Playbook –¥–ª—è –∫–æ–º–∞–Ω–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.</p>
        <a href="https://wiki.sminex.com/display/SMTE/PlayBook+Sminex+Tech" class="entry-link">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>   
¬† ¬† ¬† </div>
    </div>

    <div class="changelog-entry hidden" data-date="2025-10-02">
      <div class="entry-date">02 –æ–∫—Ç 2025</div>
      <div class="entry-content">
        <div class="entry-title">ü™Ñ –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–ø—Ä–∏–Ω—Ç–æ–≤</div>
        <p>–î–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –∏ —É–ª—É—á—à–µ–Ω–Ω—ã–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–ø—Ä–∏–Ω—Ç–æ–≤.</p>
      </div>
    </div>

  </div>

  <button class="show-more-btn">–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ</button>
</div>

<!-- === STYLES === -->
<style>
#stech-root .changelog {
  font-family: Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  color:#1d1d1f;
  max-width:800px;margin:0 auto;
  padding:40px 24px 80px;
  border-left:1.5px solid #e5e5e5;
}
#stech-root .changelog-header{font-size:22px;font-weight:700;margin-bottom:36px;color:#007aff;padding-left:12px;}
#stech-root .changelog-entry{
  display:flex;align-items:flex-start;gap:24px;margin-bottom:32px;
  opacity:0;transform:translateY(20px);
  transition:all .6s cubic-bezier(.22,1,.36,1);
}
#stech-root .changelog-entry.visible{opacity:1;transform:translateY(0);}
#stech-root .entry-date{flex:0 0 90px;font-size:13px;color:#6e6e73;text-align:right;margin-top:3px;position:relative;}
#stech-root .entry-content{flex:1;padding-left:12px;border-left:2px solid #007aff20;}
#stech-root .entry-title{font-weight:600;font-size:15px;margin-bottom:6px;}
#stech-root .entry-content p{margin:0;font-size:14px;color:#444;line-height:1.5;}
#stech-root .entry-link{display:inline-block;margin-top:6px;font-size:13px;color:#007aff;font-weight:600;text-decoration:none;}
#stech-root .entry-link:hover{color:#0056d6;}
#stech-root .hidden{display:none;}
#stech-root .show-more-btn{
  display:block;margin:24px auto 0;
  background:#f5f6f7;border:1px solid #d1d1d6;border-radius:12px;
  color:#007aff;font-weight:600;padding:10px 18px;cursor:pointer;
  transition:all .2s;
}
#stech-root .show-more-btn:hover{background:#e5e6ea;border-color:#c5c5c8;}
/* –ë–µ–π–¥–∂ "–Ω–æ–≤–æ–µ" */
#stech-root .new-dot{
  position:absolute;top:2px;right:-10px;width:8px;height:8px;
  background:#007aff;border-radius:50%;
  animation:pulse 1.8s infinite;
}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(0,122,255,.6);}
  70%{box-shadow:0 0 0 6px rgba(0,122,255,0);}
  100%{box-shadow:0 0 0 0 rgba(0,122,255,0);}
}
</style>

<!-- === SCRIPT === -->
<script>
  (function initChangelog(){
    const root=document.getElementById('stech-root');
    if(!root)return;

    const entries=root.querySelectorAll('.changelog-entry');
    const btn=root.querySelector('.show-more-btn');
    if(!entries.length||!btn)return;

    const observer=new IntersectionObserver(items=>{
      items.forEach(i=>{ if(i.isIntersecting) i.target.classList.add('visible'); });
    },{threshold:0.2});
    entries.forEach(e=>observer.observe(e));

    btn.addEventListener('click',()=>{
      root.querySelectorAll('.changelog-entry.hidden').forEach(e=>{
        e.classList.remove('hidden');observer.observe(e);
      });
      btn.style.display='none';
    });

    const today=new Date();
    entries.forEach(e=>{
      const dateStr=e.dataset.date;
      if(!dateStr)return;
      const date=new Date(dateStr);
      if((today-date)/86400000<=3){
        const dot=document.createElement('span');
        dot.className='new-dot';
        e.querySelector('.entry-date')?.appendChild(dot);
      }
    });
  })();
</script>
<!-- –ë–ª–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ -->
<div class="prod-block">
  <h2>–ü—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞</h2>
  <p>
    –í Sminex Tech –º—ã —Å–æ–∑–¥–∞–µ–º —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–æ—â–∞—é—Ç —Ä–∞–±–æ—Ç—É –∫–æ–º–ø–∞–Ω–∏–∏. –í—Å–µ —Ä–µ—à–µ–Ω–∏—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ 4 –∫–ª–∞—Å—Ç–µ—Ä–∞ —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏–∏, –∫–∞–∂–¥—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Å–≤–æ—ë –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

<style>
#stech-root .prod-block {
  width:100%;
  max-width:1200px;
  margin:0 auto;
  padding:80px 20px;
  text-align:center;
}

#stech-root .prod-block h2 {
  font-size:36px;
  font-weight:600;
  margin-bottom:60px;
}

#stech-root .prod-block p {
  font-size:16px;
  color:#6e6e73;
  max-width:800px;
  margin:0 auto 40px;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ */
#stech-root .prod-cards-wrapper {
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(240px, 1fr));
  gap:24px;
  align-items:stretch;
  justify-items:stretch;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
#stech-root .prod-card {
  width:100%;
  background:white;
  border-radius:28px;
  padding:22px 20px;
  text-align:center;
  box-shadow:0 4px 20px rgba(0,0,0,0.05);
  transition: transform 0.3s, box-shadow 0.3s;
  display:flex;
  flex-direction:column;
  justify-content:center;
  min-height:100%;
}

#stech-root .prod-card h3 {
  font-size:20px;
  font-weight:600;
  margin-bottom:10px;
}

#stech-root .prod-card p {
  color:#6e6e73;
  font-size:14px;
}

#stech-root .prod-card:hover {
  transform: translateY(-10px);
  box-shadow:0 10px 40px rgba(0,0,0,0.1);
}

/* –ê–¥–∞–ø—Ç–∏–≤ */
@media (max-width:1024px) {
  #stech-root .prod-card h3 { font-size:18px; }
  #stech-root .prod-card p { font-size:13px; }
}

@media (max-width:900px) {
  #stech-root .prod-cards-wrapper {
    grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));
    gap:18px;
  }
}
</style>
<!-- === –£–º–Ω—ã–π –ø–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ / –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ === -->
<div id="smartSearchContainer" style="
  max-width:1200px;
  margin:12px auto 20px auto;
  display:flex;
  align-items:center;
  gap:12px;
  padding:0 14px;
  position:relative;
">
  <input
    type="text"
    id="smartPersonSearch"
    placeholder="–ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–ª–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞..."
    style="flex:1; padding:8px 12px; border:1px solid #ccc; border-radius:8px; font-size:14px;"
    autocomplete="off"
  />
  <button id="smartClearSearch"
    style="padding:8px 14px; border:none; border-radius:8px; background:#0b69ff; color:#fff; cursor:pointer;">
    –û—á–∏—Å—Ç–∏—Ç—å
  </button>

  <div id="searchSuggestions" style="
    position:absolute;
    top:40px; left:14px; right:14px;
    background:#fff;
    border:1px solid #ddd;
    border-radius:8px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
    z-index:9999;
    display:none;
    max-height:240px;
    overflow:auto;
  "></div>
</div>

<!-- –ü–æ–ø–∞–ø —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ -->
<div id="searchPopup" style="
  position:fixed;
  bottom:20px;
  right:20px;
  width:360px;
  max-height:70vh;
  background:#fff;
  border:1px solid #ddd;
  border-radius:12px;
  box-shadow:0 8px 24px rgba(0,0,0,0.12);
  z-index:12000;
  display:none;
  overflow:auto;
  padding:16px;
  font-family:Inter, Arial, sans-serif;
">
  <div id="searchPopupTitle" style="font-weight:600;font-size:15px;margin-bottom:8px;"></div>
  <div id="searchPopupList"></div>
</div>

<script>
(function setupSmartSearch() {
  const input = document.getElementById('smartPersonSearch');
  const clearBtn = document.getElementById('smartClearSearch');
  const suggestions = document.getElementById('searchSuggestions');
  const popup = document.getElementById('searchPopup');
  const popupTitle = document.getElementById('searchPopupTitle');
  const popupList = document.getElementById('searchPopupList');

  let peopleCache = [];
  let productsCache = [];
  let justOpened = false;

  // === –∂–¥—ë–º –ø–æ—è–≤–ª–µ–Ω–∏—è simplifiedProducts ===
  async function waitForAssets(maxWait = 15000) {
    const start = Date.now();
    while (!window.simplifiedProducts && Date.now() - start < maxWait) {
      await new Promise(r => setTimeout(r, 300));
    }
    return window.simplifiedProducts || [];
  }

  // === –ø–æ–∏—Å–∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ ===
  function findPositionFromAssets(personName) {
    try {
      const data = window.simplifiedProducts || [];
      for (const p of data) {
        const owner = p.owners?.find(o => o.displayName === personName || o.name === personName);
        if (owner?.position) return owner.position;
        const member = p.teamUsers?.find(t => t.displayName === personName || t.name === personName);
        if (member?.position) return member.position;
      }
    } catch (e) {
      console.warn('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏', e);
    }
    return '';
  }

  // === —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ===
  function collectPeople() {
    const owners = [];
    const members = [];
    const products = [];

    document.querySelectorAll('.card').forEach(card => {
      const productName = card.querySelector('.card-title')?.textContent.trim() || '';
      const ownerEl = card.querySelector('.owner-link .tm-name');
      const ownerImg = card.querySelector('.owner-link img')?.src || '';
      const ownerName = ownerEl?.textContent.trim() || '';
      const ownerPos =
        card.querySelector('.owner-pos')?.textContent.trim() ||
        findPositionFromAssets(ownerName) ||
        '';

      const teamEls = card.querySelectorAll('.team-item');
      const teamMembers = [];

      teamEls.forEach(el => {
        const name = el.querySelector('.ti-name')?.textContent.trim();
        if (!name) return;
        const pos =
          el.querySelector('.ti-pos')?.textContent.trim() ||
          findPositionFromAssets(name) ||
          '';
        const img = el.querySelector('img')?.src || '';
        teamMembers.push({ name, position: pos, avatar: img });
      });

      if (productName)
        products.push({
          name: productName,
          owner: ownerName ? { name: ownerName, position: ownerPos, avatar: ownerImg } : null,
          team: teamMembers
        });

      if (ownerName) {
        let o = owners.find(x => x.name === ownerName);
        if (!o) {
          o = { name: ownerName, position: ownerPos, avatar: ownerImg, products: [] };
          owners.push(o);
        }
        o.products.push(productName);
      }

      teamMembers.forEach(t => {
        let m = members.find(x => x.name === t.name);
        if (!m) {
          m = { name: t.name, position: t.position, avatar: t.avatar, products: [] };
          members.push(m);
        }
        m.products.push(productName);
      });
    });

    peopleCache = [...owners, ...members].sort((a, b) => a.name.localeCompare(b.name));
    productsCache = products;
  }

  // === —Ä–µ–Ω–¥–µ—Ä –ø–æ–¥—Å–∫–∞–∑–æ–∫ ===
  function renderSuggestions(list, query) {
    if (!list.length) { suggestions.style.display = 'none'; return; }
    const q = query.toLowerCase();
    suggestions.innerHTML = list.map(p => `
      <div class="suggest-item" data-name="${p.name}">
        <div style="padding:8px 12px;display:flex;align-items:center;gap:10px;cursor:pointer;">
          ${p.avatar ? `<img src="${p.avatar}" style="width:26px;height:26px;border-radius:50%;object-fit:cover;">` :
            `<div style="width:26px;height:26px;border-radius:50%;background:#ccc;"></div>`}
          <div>
            <div>${p.name.replace(new RegExp(q, 'gi'), m => '<b>'+m+'</b>')}</div>
            ${p.position ? `<div style="font-size:11px;color:#777;">${p.position}</div>` : ''}
          </div>
        </div>
      </div>`).join('');
    suggestions.style.display = 'block';
  }

  // === –ø–æ–ø-–∞–ø —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ ===
  function showPopupForPerson(person) {
    popup.style.display = 'block';
    justOpened = true;
    setTimeout(() => (justOpened = false), 200);

    popupTitle.innerHTML = `
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
        ${person.avatar ? `<img src="${person.avatar}" style="width:46px;height:46px;border-radius:50%;object-fit:cover;">`
          : `<div style="width:46px;height:46px;border-radius:50%;background:#ccc;"></div>`}
        <div>
          <div style="font-weight:600;font-size:15px;">${person.name}</div>
          ${person.position ? `<div style="font-size:13px;color:#555;">${person.position}</div>` : ''}
        </div>
      </div>`;

    const prods = productsCache.filter(
      p => p.owner?.name === person.name || p.team.some(t => t.name === person.name)
    );

    popupList.innerHTML = prods.map(prod => `
      <div style="padding:6px 0;border-bottom:1px dashed #eee;">
        <a href="#" class="popup-prod" data-prod="${prod.name}" style="color:#0b69ff;font-weight:500;text-decoration:none;">
          ${prod.name}${prod.owner?.name === person.name ? ' ‚≠ê' : ''}
        </a>
        ${prod.owner ? `<div style="font-size:12px;color:#555;">–í–ª–∞–¥–µ–ª–µ—Ü: ${prod.owner.name}${prod.owner.position ? `, <i>${prod.owner.position}</i>` : ''}</div>` : ''}
        <div style="font-size:12px;color:#555;margin-top:4px;">
          –ö–æ–º–∞–Ω–¥–∞: ${prod.team.map(t => `${t.name}${t.position ? ` (<i>${t.position}</i>)` : ''}`).join(', ')}
        </div>
      </div>`).join('');
  }

  // === –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ===
  suggestions.addEventListener('mousedown', e => {
    const name = e.target.closest('.suggest-item')?.dataset.name;
    if (!name) return;
    const person = peopleCache.find(p => p.name === name);
    if (person) showPopupForPerson(person);
    suggestions.style.display = 'none';
    e.preventDefault();
  });

  popupList.addEventListener('click', e => {
    const link = e.target.closest('.popup-prod');
    if (!link) return;
    e.preventDefault();
    const prod = link.dataset.prod;
    const cards = Array.from(document.querySelectorAll('.card'))
      .filter(c => (c.querySelector('.card-title')?.textContent || '').trim() === prod);
    if (cards.length) {
      document.querySelectorAll('.card.highlight').forEach(c => c.classList.remove('highlight'));
      cards.forEach(c => c.classList.add('highlight'));
      cards[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  });

  input.addEventListener('input', () => {
    const q = input.value.trim().toLowerCase();
    if (!q) { suggestions.style.display = 'none'; popup.style.display = 'none'; return; }
    if (!peopleCache.length) collectPeople();
    const matches = peopleCache.filter(p => p.name.toLowerCase().includes(q)).slice(0, 15);
    renderSuggestions(matches, q);
  });

  clearBtn.addEventListener('click', () => {
    input.value = '';
    suggestions.style.display = 'none';
    popup.style.display = 'none';
  });

  document.addEventListener('click', e => {
    if (justOpened) return;
    if (!suggestions.contains(e.target) && e.target !== input) suggestions.style.display = 'none';
    if (!popup.contains(e.target) && !e.target.closest('.popup-prod')) popup.style.display = 'none';
  });

  // === –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∞—Å—Å–µ—Ç–æ–≤ ===
  (async () => {
    await waitForAssets();
    collectPeople();
  })();
})();
</script>




<!-- Controls + popup -->
<div id="clustersControls" style="max-width:1200px;margin:12px auto 0;padding:0 14px; display:flex; gap:16px; align-items:center;">
<div style="display:flex;align-items:center;gap:12px;">
<label style="font-size:13px;margin-right:8px;">–†–µ–∂–∏–º:</label>
<select id="viewMode" style="padding:6px 8px;border-radius:6px;border:1px solid #ddd;font-size:13px;">
<option value="products">–ü–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º</option>
<option value="roles">–ü–æ —Ä–æ–ª—è–º</option>
</select>
<span id="positionsLoader" class="loader-inline" style="display:none;">–ü–æ–¥–≥—Ä—É–∂–∞–µ–º –¥–æ–ª–∂–Ω–æ—Å—Ç–∏‚Ä¶</span>
</div>
<div style="font-size:13px;color:#666;">–©—ë–ª–∫–Ω–∏—Ç–µ –Ω–∞ –∏–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–ª–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ ‚Äî —É–≤–∏–¥–∏—Ç–µ, –≤ –∫–∞–∫–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –æ–Ω —É—á–∞—Å—Ç–≤—É–µ—Ç</div>
</div>

<div id="assets-clusters-root"></div>

<style>
/* === –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã === */
#stech-root #assets-clusters-root {
  font-family: Inter, Arial, sans-serif;
  padding: 14px;
  color: #222;
  max-width: 1200px;
  margin: 0 auto;
}

#stech-root .cluster {
  margin-bottom: 28px;
}

/* === –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ === */
#stech-root .cluster-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 10px;
}

#stech-root .cluster-title {
  font-size: 18px;
  font-weight: 700;
  color: #0B3C5D;
}

#stech-root .cluster-count {
  font-size: 13px;
  color: #666;
}

/* === –ö–∞—Ä—Ç–æ—á–∫–∏ === */
#stech-root .cluster-row {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: minmax(280px, 1fr);
  gap: 16px;
  overflow-x: auto;
  padding: 16px 20px;
  scroll-snap-type: x mandatory;
  scroll-padding: 20px;
  -webkit-overflow-scrolling: touch;
  align-items: stretch;
}

#stech-root .card {
  width: 100%;
  min-width: 280px;
  max-width: 360px;
  box-sizing: border-box;
  background: #fff;
  border: 1px solid #e6e9ee;
  border-radius: 10px;
  padding: 14px;
  scroll-snap-align: start;
  display: flex;
  flex-direction: column;
  min-height: 230px;
  position: relative;
}

@media (max-width: 1024px) {
  #stech-root .cluster-row { grid-auto-columns: minmax(260px, 1fr); padding: 14px 16px; }
}
@media (max-width: 760px) {
  #stech-root .cluster-row { grid-auto-columns: minmax(78vw, 1fr); gap: 14px; }
  #stech-root .card { min-width: 240px; max-width: 320px; }
}

#stech-root .card-head { display: flex; gap: 10px; align-items: center; }
#stech-root .card-avatar {
  width: 48px; height: 48px;
  border-radius: 6px; background: #f4f6f8;
  display: flex; align-items: center; justify-content: center;
  overflow: hidden; flex: 0 0 48px;
}
#stech-root .card-avatar img { width: 100%; height: 100%; object-fit: cover; }

#stech-root .card-title {
  font-weight: 600;
  color: #0B3C5D;
  font-size: 15px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.2;
}

#stech-root .card-sub {
  font-size: 12px;
  color: #666;
  margin-top: 6px;
}

#stech-root .card-body.desc {
  margin-top: 8px;
  font-size: 13px;
  color: #222;
  display: -webkit-box;
  -webkit-line-clamp: 6;
  -webkit-box-orient: vertical;
  overflow: hidden;
  line-height: 1.4;
  flex: 1;
}

/* === –í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ–¥—É–∫—Ç–∞ === */
#stech-root .team {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 4px;
  margin-top: 8px;
}

#stech-root .owner-link {
  display: flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
  color: inherit;
}

#stech-root .owner-link .avatar-sm {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  overflow: hidden;
  background: #f4f6f8;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: #163a63;
}

#stech-root .owner-link .avatar-sm img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#stech-root .name-wrap {
  display: flex;
  flex-direction: column;
  justify-content: center;
  line-height: 1.2;
}

#stech-root .tm-name {
  font-weight: 600;
  font-size: 13px;
  color: #0b3c5d;
}

#stech-root .owner-pos {
  font-size: 12px;
  color: #666;
  font-style: italic;
}

/* === –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ === */
#stech-root .team-list {
  margin-top: 8px;
  border-top: 1px dashed #e6e9ee;
  padding-top: 8px;
  max-height: 240px;
  overflow: auto;
}

#stech-root .team-item {
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 6px 4px;
  border-radius: 6px;
}
#stech-root .team-item:hover { background: #fbfdff; cursor: default; }

#stech-root .avatar-lg {
  width: 36px; height: 36px;
  border-radius: 50%;
  background: #f4f6f8;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; color: #163a63;
  overflow: hidden;
}
#stech-root .avatar-lg img { width: 100%; height: 100%; object-fit: cover; }

#stech-root .ti-text { display: flex; flex-direction: column; }
#stech-root .ti-name { font-size: 13px; color: #0b3c5d; font-weight: 600; }
#stech-root .ti-pos { font-size: 12px; color: #444; font-style: italic; margin-top: 2px; }

/* === –ö–Ω–æ–ø–∫–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ === */
#stech-root .cluster-wrap {
  position: relative;
  overflow: visible;
}

#stech-root .cluster-wrap::before,
#stech-root .cluster-wrap::after {
  content: '';
  position: absolute;
  top: 12px;
  bottom: 12px;
  width: 34px;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease;
  z-index: 5;
}

#stech-root .cluster-wrap::before {
  left: 0;
  background: linear-gradient(90deg, #f9fafc 0%, rgba(249, 250, 252, 0));
}

#stech-root .cluster-wrap::after {
  right: 0;
  background: linear-gradient(270deg, #f9fafc 0%, rgba(249, 250, 252, 0));
}

#stech-root .cluster-wrap.is-scrollable::before,
#stech-root .cluster-wrap.is-scrollable::after { opacity: 1; }
#stech-root .cluster-wrap.at-start::before { opacity: 0; }
#stech-root .cluster-wrap.at-end::after { opacity: 0; }

#stech-root .scroll-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: rgba(11,105,255,0.95);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 10;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
#stech-root .scroll-btn.left { left: 4px; }
#stech-root .scroll-btn.right { right: 4px; }
#stech-root .scroll-btn[disabled] { opacity: 0.4; cursor: default; }

/* === –ê–∫–∫–æ—Ä–¥–µ–æ–Ω—ã (–ø–æ —Ä–æ–ª—è–º) === */
#stech-root .collapsible-header {
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  user-select: none;
}
/* --- –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –≤ —Ä–µ–∂–∏–º–µ "–ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º" --- */
#stech-root .cluster-head.collapsible-header .arrow {
  width: 8px;
  height: 8px;
  border-right: 2px solid #0b3c5d;
  border-bottom: 2px solid #0b3c5d;
  transform: rotate(-45deg);
  transition: transform 0.2s ease;
  margin-right: 6px;
}
#stech-root .cluster-head.collapsible-header.collapsed .arrow {
  transform: rotate(135deg);
}
#stech-root .cluster-content.collapsed {
  display: none;
}
#stech-root .cluster-head:hover {
  background: #f9fafc;
  border-radius: 4px;
}

#stech-root .role-content.collapsed,
#stech-root .cluster-content.collapsed { display: none; }

#stech-root .collapsible-header .arrow {
  display: inline-block;
  width: 8px; height: 8px;
  border-right: 2px solid #0b3c5d;
  border-bottom: 2px solid #0b3c5d;
  transform: rotate(-45deg);
  transition: transform 0.2s ease;
  margin-right: 6px;
}
#stech-root .collapsible-header.collapsed .arrow { transform: rotate(135deg); }

/* === –ü—Ä–æ—á–µ–µ === */
#stech-root .cluster-footer { margin-top: 8px; font-size: 12px; color: #666; }
#stech-root .card.highlight {
  box-shadow: 0 8px 30px rgba(11,105,255,0.12);
  border-color: #0b69ff !important;
  transform: translateY(-4px);
}
/* === –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã === */
#stech-root .roadmap {
  margin-top: 8px;
  font-size: 13px;
}
#stech-root .roadmap a {
  color: #0b69ff;
  text-decoration: none;
  display: inline-flex;
  gap: 6px;
  align-items: center;
}
#stech-root .roadmap a:hover {
  text-decoration: underline;
}
#stech-root .roadmap .icon {
  width: 18px;
  height: 18px;
  display: inline-block;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%230b69ff" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm10 8h8V3h-8v18zM3 21h8v-6H3v6z"/></svg>') no-repeat center/contain;
}

/* === –£–ª—É—á—à–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ === */
#stech-root .card-body.desc {
  margin-top: 10px;
  font-size: 13px;
  color: #333;
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* === –ü–æ–ø–∞–ø –ø–æ–≤–µ—Ä—Ö –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—Ñ–∏–∫—Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏) === */
#stech-root .popup {
  position: fixed;
  right: 20px;
  bottom: 20px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  z-index: 20000; /* –±—ã–ª–æ 12000 ‚Äî –ø–æ–¥–Ω–∏–º–µ–º –≤—ã—à–µ —Å—Ç—Ä–µ–ª–æ–∫ */
  width: 320px;
  max-height: 60vh;
  overflow-y: auto;
  display: none;
}
/* === –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫–∫—É—Ä–∞—Ç–Ω—É—é –≤–µ—Ä—Å—Ç–∫—É —Ä–µ–∂–∏–º–∞ "–ø–æ —Ä–æ–ª—è–º" === */
#stech-root .role-section {
  margin-bottom: 28px;
  border-radius: 10px;
  background: #fff;
  border: 1px solid #e6e9ee;
  padding: 12px 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.04);
}

#stech-root .role-section h4 {
  font-size: 17px;
  font-weight: 600;
  color: #0b3c5d;
  margin: 0 0 12px 0;
  cursor: pointer;
  user-select: none;
  display: flex;
  align-items: center;
  gap: 6px;
}

#stech-root .cluster-block {
  margin: 10px 0 18px 12px;
  border-left: 3px solid #e6e9ee;
  padding-left: 12px;
}

#stech-root .cluster-head {
  font-weight: 600;
  color: #0b3c5d;
  font-size: 14px;
  margin: 6px 0;
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
}

#stech-root .cluster-content {
  margin-top: 6px;
  padding-left: 10px;
}

#stech-root .owner-block {
  margin: 8px 0 14px 0;
  padding: 10px;
  border-radius: 8px;
  background: #f9fafc;
  border: 1px solid #e6e9ee;
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

#stech-root .owner-meta {
  min-width: 180px;
}

#stech-root .o-name {
  font-weight: 600;
  color: #0b3c5d;
  font-size: 14px;
}

#stech-root .o-count {
  font-size: 12px;
  color: #777;
}

#stech-root .member-row {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  padding: 6px 0;
  border-bottom: 1px dashed #e6e9ee;
}

#stech-root .member-row:last-child {
  border-bottom: none;
}

#stech-root .member-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  overflow: hidden;
  background: #f4f6f8;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: 13px;
  color: #163a63;
}

#stech-root .member-info {
  flex: 1;
}

#stech-root .m-name {
  font-weight: 600;
  font-size: 13px;
  color: #0b3c5d;
}

#stech-root .m-pos {
  font-size: 12px;
  color: #666;
  font-style: italic;
}

#stech-root .member-prods a {
  font-size: 12px;
  color: #0b69ff;
  text-decoration: none;
}

#stech-root .member-prods a:hover {
  text-decoration: underline;
}
/* --- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ 6 —Å—Ç—Ä–æ–∫–∞–º–∏ --- */
#stech-root .card-body.desc {
  display: -webkit-box !important;
  -webkit-line-clamp: 6 !important;
  -webkit-box-orient: vertical !important;
  overflow: hidden !important;
  text-overflow: ellipsis;
  white-space: normal;
  line-height: 1.45;
  max-height: calc(1.45em * 6);
  margin-bottom: 8px;
}
/* --- –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç—Ä–µ–ª–∫–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ —Ä–µ–∂–∏–º–µ "–ø–æ —Ä–æ–ª—è–º" --- */
#stech-root .cluster-head {
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  user-select: none;
  font-weight: 600;
  color: #0b3c5d;
  font-size: 14px;
  margin: 6px 0;
  padding-left: 2px; /* –ª—ë–≥–∫–∏–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –∞–∫–∫—É—Ä–∞—Ç–Ω–æ—Å—Ç–∏ */
}

#stech-root .cluster-head .arrow {
  width: 8px;
  height: 8px;
  border-right: 2px solid #0b3c5d;
  border-bottom: 2px solid #0b3c5d;
  transform: rotate(135deg);
  transition: transform 0.2s ease;
  margin: 0; /* —É–±—Ä–∞–ª–∏ –ø—Ä–µ–∂–Ω–∏–π –±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø */
}

#stech-root .cluster-head.collapsed .arrow {
  transform: rotate(-45deg);
}

#stech-root .cluster-head .cluster-name {
  display: inline-block;
  vertical-align: middle;
  margin: 0; /* –ø–ª–æ—Ç–Ω–æ–µ –ø—Ä–∏–ª–µ–≥–∞–Ω–∏–µ –∫ —Å—Ç—Ä–µ–ª–∫–µ */
}
/* --- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (–ø–æ —Ä–æ–ª—è–º) --- */
#stech-root .cluster-block {
  margin: 10px 0 18px 16px;
  border-left: 3px solid #e6e9ee;
  padding-left: 10px;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞ ‚Äî —Å—Ç—Ä–µ–ª–∫–∞ –∏ —Ç–µ–∫—Å—Ç –≤ –æ–¥–Ω—É –ª–∏–Ω–∏—é, –ø—Ä–∏–∂–∞—Ç—ã –≤–ª–µ–≤–æ */
#stech-root .cluster-head {
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  gap: 6px;
  font-weight: 600;
  color: #0b3c5d;
  font-size: 14px;
  margin: 8px 0;
  cursor: pointer;
  user-select: none;
  width: auto;
  padding-left: 2px;
}

/* –°—Ç—Ä–µ–ª–∫–∞ –≤–æ–∑–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è */
#stech-root .cluster-head .arrow {
  width: 8px;
  height: 8px;
  border-right: 2px solid #0b3c5d;
  border-bottom: 2px solid #0b3c5d;
  transform: rotate(135deg);
  transition: transform 0.2s ease;
  margin: 0;
}

#stech-root .cluster-head.collapsed .arrow {
  transform: rotate(-45deg);
}

#stech-root .cluster-head .cluster-name {
  display: inline-block;
  vertical-align: middle;
  margin: 0;
}

/* –î–æ–±–∞–≤–∏–º –ª—ë–≥–∫—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
#stech-root .cluster-head:hover {
  background: #f9fafc;
  border-radius: 4px;
}
/* === –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å—Ç–∏–ª–µ–π –ª–µ–Ω–¥–∏–Ω–≥–∞ === */
#assets-clusters-root,
#assets-clusters-root * {
  text-align: left !important;
  justify-content: flex-start !important;
  align-items: flex-start !important;
}

#assets-clusters-root .cluster-head,
#assets-clusters-root .role-section h4,
#assets-clusters-root .cluster-block {
  text-align: left !important;
  justify-content: flex-start !important;
  align-items: center !important;
}

#assets-clusters-root .cluster-head .cluster-name {
  display: inline-block !important;
  text-align: left !important;
}

#assets-clusters-root .arrow {
  margin-right: 6px !important;
}
/* === –ü–æ–ø–∞–ø—ã –∏ –ø–æ–∏—Å–∫ ‚Äî –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é === */
#searchPopup,
#searchPopup *,
#searchSuggestions,
#searchSuggestions *,
#stech-root .popup,
#stech-root .popup * {
  text-align: left !important;
  justify-content: flex-start !important;
  align-items: flex-start !important;
}

/* –î–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ —Å–ø–∏—Å–∫–∞ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ø–∞–ø–∞ */
#searchPopupTitle, #popupTitle {
  text-align: left !important;
}

#searchPopupList, #popupList {
  text-align: left !important;
  padding-left: 0 !important;
  margin-left: 0 !important;
}

/* –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–∏—Å–∫–∞ ‚Äî —Ç–æ–∂–µ —Å—Ç—Ä–æ–≥–æ –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é */
#searchSuggestions .suggest-item div {
  text-align: left !important;
}
/* === –ü–æ–ø–∞–ø—ã –∏ –ø–æ–∏—Å–∫ ‚Äî –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é === */
#searchPopup,
#searchPopup *,
#searchSuggestions,
#searchSuggestions *,
#stech-root .popup,
#stech-root .popup * {
  text-align: left !important;
  justify-content: flex-start !important;
  align-items: flex-start !important;
}

/* –î–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ —Å–ø–∏—Å–∫–∞ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ø–∞–ø–∞ */
#searchPopupTitle, #popupTitle {
  text-align: left !important;
}

#searchPopupList, #popupList {
  text-align: left !important;
  padding-left: 0 !important;
  margin-left: 0 !important;
}

/* –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–∏—Å–∫–∞ ‚Äî —Ç–æ–∂–µ —Å—Ç—Ä–æ–≥–æ –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é */
#searchSuggestions .suggest-item div {
  text-align: left !important;
}
</style>



<div id="assets-clusters-root"></div>

<div class="popup" id="popup">
<h4 id="popupTitle"></h4>
<ul id="popupList"></ul>
</div>

<script>
(async function(){
// === –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ===
const objectSchemaId = 2;
const iql = 'objectType = "–ü—Ä–æ–¥—É–∫—Ç" AND "–°—Ç–∞—Ç—É—Å" in ("In progress", "Support ")';
const resultPerPage = 100;
const maxPages = 20;
const proxyBase = '/rest/ifc/1.0/jira-proxy?url=';
const showObjectBase = '/secure/ShowObject.jspa?id=';
const clusterOrder = [
'–¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞',
'–¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å–∏—Å—Ç–µ–º',
'–¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏',
'–¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤'
];

const PROFILE_FETCH_CONCURRENCY = 6; // –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ø—Ä–æ—Ñ–∏–ª—è–º
window.__positionCache = window.__positionCache || new Map(); // –∫—ç—à –ø–æ–∑–∏—Ü–∏–π –ø–æ profilePath
let positionsLoaded = false; // —Ñ–ª–∞–≥, —á—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ —É–∂–µ –ø–æ–¥–≥—Ä—É–∂–µ–Ω—ã

const root = document.getElementById('assets-clusters-root');
const contentArea = root;
const popup = document.getElementById('popup');
const popupTitle = document.getElementById('popupTitle');
const popupList = document.getElementById('popupList');
const positionsLoaderEl = document.getElementById('positionsLoader');

root.innerHTML = '<div class="note">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö‚Ä¶</div>';

// === —É—Ç–∏–ª–∏—Ç—ã ===
function buildProxyUrl(page){
const inner = '/rest/insight/1.0/iql/objects'
+ '?objectSchemaId=' + encodeURIComponent(objectSchemaId)
+ '&iql=' + encodeURIComponent(iql)
+ '&resultPerPage=' + encodeURIComponent(resultPerPage)
+ '&page=' + encodeURIComponent(page)
+ '&includeAttributesDeep=1&includeTypeAttributes=true';
return proxyBase + encodeURIComponent(inner);
}
function safeText(s){ return s === null || s === undefined ? '' : String(s); }
function stripHtml(html){
if (!html) return '';
try { const tmp = document.createElement('div'); tmp.innerHTML = html; return tmp.textContent || tmp.innerText || ''; }
catch(e) { return String(html).replace(/<[^>]*>/g, ''); }
}

// helper to get attribute value (handles array/object/raw)
function getAttrValue(attrs, attrName){
if (!attrs || !attrName) return '';
const a = attrs[attrName];
if (!a) return '';
const v = Array.isArray(a) ? a[0] : a;
if (!v) return '';
if (v.raw && typeof v.raw === 'object') {
if (v.raw.value) return v.raw.value;
if (v.raw.displayValue) return v.raw.displayValue;
}
if (v.value) return v.value;
if (v.displayValue) return v.displayValue;
if (v.text) return v.text;
return '';
}

// --- –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ (–µ—Å–ª–∏ referencedObject —Å–æ–¥–µ—Ä–∂–∏—Ç –∞—Ç—Ä–∏–±—É—Ç—ã) ---
function extractPositionFromReferenced(ro) {
if (!ro) return '';
const candidateAttrs = ro.attributes || ro.objectAttributes || ro.objectAttributeValues || [];
if (!Array.isArray(candidateAttrs)) return '';
for (const a of candidateAttrs) {
const name = (a.objectTypeAttribute && (a.objectTypeAttribute.name || a.objectTypeAttribute.label)) || a.name || a.label || '';
if (!name) continue;
const low = String(name).toLowerCase();
if (low.includes('–¥–æ–ª–∂') || low.includes('position') || low.includes('role') || low.includes('–¥–æ–ª–∂–Ω–æ—Å—Ç—å')) {
const vals = a.objectAttributeValues || a.values || a.attributeValues || [];
if (Array.isArray(vals) && vals.length > 0) {
const v = vals[0];
return v.displayValue || v.value || v.name || String(v) || '';
}
if (a.displayValue) return a.displayValue;
if (a.value) return a.value;
}
}
return '';
}

// –ø–∞—Ä—Å–µ—Ä –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (product)
function parseAttributes(entry){
const map = {};
(entry.attributes || []).forEach(attr => {
const key = (attr.objectTypeAttribute && (attr.objectTypeAttribute.name || attr.objectTypeAttribute.label)) || ('attr_' + attr.id);
const vals = (attr.objectAttributeValues || []).map(v => {
if (v.user) {
const u = v.user;
return { text: u.displayName || v.displayValue || '', user: { avatarUrl: u.avatarUrl || '', displayName: u.displayName || '', name: u.name || '', key: u.key || '', profile: '/secure/ViewProfile.jspa?name=' + encodeURIComponent(u.name || '') }, raw: v };
}
if (v.referencedType && v.referencedObject) {
const ro = v.referencedObject;
const position = extractPositionFromReferenced(ro);
return { text: ro.name || ro.label || v.displayValue || v.value, referencedObject: ro, position, raw: ro };
}
return { text: v.displayValue || v.value || '', raw: v };
});
map[key] = vals.length > 1 ? vals : (vals[0] || null);
});
return map;
}

function extractUsers(v){
if (!v) return [];
const arr = Array.isArray(v) ? v : [v];
return arr.map(item => {
if (item.user) {
const u = item.user;
return {
avatarUrl: u.avatarUrl || '',
displayName: u.displayName || '',
name: u.name || '',
key: u.key || '',
profile: '/secure/ViewProfile.jspa?name=' + encodeURIComponent(u.name || ''),
position: ''
};
}
if (item.referencedObject) {
const ro = item.referencedObject;
const avatar = (ro.avatar && (ro.avatar.url48 || ro.avatar.url16)) || ro.avatarUrl || '';
const pos = extractPositionFromReferenced(ro) || item.position || '';
return {
avatarUrl: avatar,
displayName: ro.name || ro.label || item.text || '',
name: ro.objectKey || '',
key: ro.id || '',
profile: (ro._links && ro._links.self) ? ro._links.self : (showObjectBase + (ro.id || '')),
position: pos
};
}
if (item.raw && item.raw.referencedObject) {
const ro = item.raw.referencedObject;
const avatar = (ro.avatar && (ro.avatar.url48 || ro.avatar.url16)) || ro.avatarUrl || '';
const pos = extractPositionFromReferenced(ro) || '';
return {
avatarUrl: avatar,
displayName: ro.name || ro.label || item.text || '',
name: ro.objectKey || '',
key: ro.id || '',
profile: (ro._links && ro._links.self) ? ro._links.self : (showObjectBase + (ro.id || '')),
position: pos
};
}
return { avatarUrl: '', displayName: item.text || '', name: '', key:'', profile:'', position: '' };
}).filter(Boolean);
}

// --- –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ç—É–ª—Ç–∏–ø –¥–ª—è –¥–ª–∏–Ω–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è ---
let tooltipEl = null;
function ensureTooltip(){
if (tooltipEl) return tooltipEl;
tooltipEl = document.createElement('div');
tooltipEl.className = 'custom-tooltip';
tooltipEl.style.display = 'none';
document.body.appendChild(tooltipEl);
window.addEventListener('scroll', () => { if (tooltipEl) tooltipEl.style.display = 'none'; }, true);
window.addEventListener('resize', () => { if (tooltipEl) tooltipEl.style.display = 'none'; });
document.addEventListener('click', () => { if (tooltipEl) tooltipEl.style.display = 'none'; });
return tooltipEl;
}
function showTooltipFor(elem, text){
if (!text) return;
const tip = ensureTooltip();
tip.textContent = text;
tip.style.display = 'block';
const rect = elem.getBoundingClientRect();
const tipRect = tip.getBoundingClientRect();
let left = rect.right + 10 + window.scrollX;
let top = rect.top + window.scrollY;
if (left + tipRect.width > window.scrollX + document.documentElement.clientWidth - 10) {
left = rect.left + window.scrollX - tipRect.width - 10;
}
if (top + tipRect.height > window.scrollY + document.documentElement.clientHeight - 10) {
top = window.scrollY + document.documentElement.clientHeight - tipRect.height - 10;
}
tip.style.left = (left) + 'px';
tip.style.top = (top) + 'px';
}
function hideTooltip(){ if (tooltipEl) tooltipEl.style.display = 'none'; }

// === fetch –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ Assets ===
let allEntries = []; // raw entries
let simplifiedProducts = []; // [{name, cluster, entryId, owners:[], teamUsers:[], attrs, entry}]
async function fetchAll(){
let page = 1;
const all = [];
while (page <= maxPages) {
const url = buildProxyUrl(page);
let res;
try { res = await fetch(url, { credentials: 'same-origin' }); }
catch (e) { throw new Error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ' + e.message); }
if (!res.ok) {
const txt = await res.text().catch(()=>res.statusText);
throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª ' + res.status + ' ‚Äî ' + txt);
}
const data = await res.json().catch(()=>{ throw new Error('–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON'); });
const entries = data.objectEntries || [];
all.push(...entries);
if (entries.length < resultPerPage) break;
page++;
}
return all;
}

// –°–±–æ—Ä–∫–∞ simplifiedProducts ‚Äî —Ç–µ–ø–µ—Ä—å owners –∏ teamUsers –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã (–Ω–µ —Å—Ç—Ä–æ–∫–∏)
function buildSimplified(productsEntries){
const res = [];
productsEntries.forEach(entry => {
const attrs = parseAttributes(entry);
const name = (attrs['Name'] && (Array.isArray(attrs['Name']) ? attrs['Name'][0].text : attrs['Name'].text)) || entry.label || entry.objectKey || ('PRODUCT-' + entry.id);
const cluster = attrs['–ö–ª–∞—Å—Ç–µ—Ä - –ü—Ä–æ–¥—É–∫—Ç'] ? (Array.isArray(attrs['–ö–ª–∞—Å—Ç–µ—Ä - –ü—Ä–æ–¥—É–∫—Ç']) ? attrs['–ö–ª–∞—Å—Ç–µ—Ä - –ü—Ä–æ–¥—É–∫—Ç'].map(x=>x.text).join(', ') : attrs['–ö–ª–∞—Å—Ç–µ—Ä - –ü—Ä–æ–¥—É–∫—Ç'].text) : '–ë–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞';
const owners = extractUsers(attrs['–í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ–¥—É–∫—Ç–∞']); // –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
const teamUsers = extractUsers(attrs['–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–¥—É–∫—Ç–∞']); // –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
res.push({ name, cluster, entryId: entry.id, owners, teamUsers, attrs, entry });
});
return res;
}

// ---------- –†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: –ø–æ–ª—É—á–µ–Ω–∏–µ –î–æ–ª–∂–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥ ViewProfile ----------
function normalizeProfilePath(profile) {
if (!profile) return null;
try {
const u = new URL(profile, window.location.origin);
return u.pathname + (u.search || '');
} catch (e) {
return profile;
}
}
function buildProfileProxyUrl(profilePath) {
if (!profilePath) return null;
const inner = profilePath;
return '/rest/ifc/1.0/jira-proxy?url=' + encodeURIComponent(inner);
}
async function fetchPositionFromProfilePath(profilePath) {
if (!profilePath) return '';
if (window.__positionCache.has(profilePath)) return window.__positionCache.get(profilePath);
const proxy = buildProfileProxyUrl(profilePath);
if (!proxy) { window.__positionCache.set(profilePath, ''); return ''; }
try {
const res = await fetch(proxy, { credentials: 'same-origin' });
if (!res.ok) { window.__positionCache.set(profilePath, ''); return ''; }
const html = await res.text();
const parser = new DOMParser();
const doc = parser.parseFromString(html, 'text/html');
const ldap = doc.querySelector('#ldap-sync-fragment') || doc.querySelector('.ldap-sync-fragment');
if (!ldap) {
const allDt = doc.querySelectorAll('dt');
for (const dt of allDt) {
const name = (dt.textContent || '').trim();
if (/–¥–æ–ª–∂–Ω–æ—Å—Ç|–¥–æ–ª–∂|position|role/i.test(name)) {
const dd = dt.nextElementSibling;
if (dd && dd.tagName && dd.tagName.toLowerCase() === 'dd') {
const pos = dd.textContent.trim();
window.__positionCache.set(profilePath, pos);
return pos;
}
}
}
window.__positionCache.set(profilePath, '');
return '';
}
const dts = ldap.querySelectorAll('dt');
for (const dt of dts) {
const name = (dt.textContent || '').trim();
if (/–¥–æ–ª–∂–Ω–æ—Å—Ç|–¥–æ–ª–∂|position|role/i.test(name)) {
const dd = dt.nextElementSibling;
if (dd && dd.tagName && dd.tagName.toLowerCase() === 'dd') {
const pos = dd.textContent.trim();
window.__positionCache.set(profilePath, pos);
return pos;
}
}
}
window.__positionCache.set(profilePath, '');
return '';
} catch (e) {
console.warn('fetchPositionFromProfilePath error', profilePath, e);
window.__positionCache.set(profilePath, '');
return '';
}
}
async function fetchPositionsForProfiles(profilePaths) {
const unique = Array.from(new Set(profilePaths.filter(Boolean)));
const result = new Map();
for (let i = 0; i < unique.length; i += PROFILE_FETCH_CONCURRENCY) {
const slice = unique.slice(i, i + PROFILE_FETCH_CONCURRENCY);
await Promise.all(slice.map(async p => {
try {
const path = normalizeProfilePath(p);
const pos = await fetchPositionFromProfilePath(path);
result.set(p, pos || '');
} catch (e) {
result.set(p, '');
}
}));
}
return result;
}
async function enrichPositionsInSimplified(simplified) {
const profiles = [];
simplified.forEach(p => {
(p.owners || []).forEach(o => { if (o && o.profile) profiles.push(o.profile); });
(p.teamUsers || []).forEach(u => { if (u && u.profile) profiles.push(u.profile); });
});
if (!profiles.length) return;
positionsLoaderEl.style.display = 'inline';
const map = await fetchPositionsForProfiles(profiles);
simplified.forEach(p => {
(p.owners || []).forEach(o => {
if (o && o.profile && map.has(o.profile)) o.position = map.get(o.profile) || '';
});
(p.teamUsers || []).forEach(u => {
if (u && u.profile && map.has(u.profile)) u.position = map.get(u.profile) || '';
});
});
positionsLoaderEl.style.display = 'none';
positionsLoaded = true;
}

// === —Ä–µ–Ω–¥–µ—Ä ===
function createCardFromSimple(prod) {
  const entry = prod.entry;
  const attrs = prod.attrs;
  const card = document.createElement('div');
  card.className = 'card';
  card.dataset.entryId = prod.entryId;

  // --- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ ---
  const head = document.createElement('div');
  head.className = 'card-head';

  const avatarWrap = document.createElement('div');
  avatarWrap.className = 'card-avatar';
  const avatarUrl =
    (entry.avatar && entry.avatar.url48) ||
    (entry.objectType && entry.objectType.icon && entry.objectType.icon.url48) ||
    '';
  if (avatarUrl) {
    const img = document.createElement('img');
    img.src = avatarUrl;
    avatarWrap.appendChild(img);
  } else {
    avatarWrap.textContent =
      (entry.objectType && entry.objectType.name
        ? entry.objectType.name[0]
        : entry.label
        ? entry.label[0]
        : 'P');
  }
  head.appendChild(avatarWrap);

  const twrap = document.createElement('div');
  const title = document.createElement('div');
  title.className = 'card-title';
  title.textContent = prod.name;
  twrap.appendChild(title);

  const sub = document.createElement('div');
  sub.className = 'card-sub';
  sub.textContent = prod.cluster || '';
  twrap.appendChild(sub);
  head.appendChild(twrap);
  card.appendChild(head);

  // --- –û–ø–∏—Å–∞–Ω–∏–µ ---
  const rawDesc = attrs['–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞']
    ? Array.isArray(attrs['–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞'])
      ? attrs['–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞'].map(x => x.text).join('\n')
      : attrs['–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞'].text ||
        attrs['–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞'].displayValue ||
        attrs['–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞'].value ||
        ''
    : '';
  const plainDesc = stripHtml(rawDesc).trim();
  const body = document.createElement('div');
  body.className = 'card-body desc';
  body.textContent = plainDesc;
  card.appendChild(body);

  // --- –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ ---
  const roadmapUrl = getAttrValue(attrs, '–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞');
  if (roadmapUrl) {
    const r = document.createElement('div');
    r.className = 'roadmap';
    const a = document.createElement('a');
    a.href = roadmapUrl;
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.innerHTML = `<span class="icon"></span><span>–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞</span>`;
    r.appendChild(a);
    card.appendChild(r);
  }

  // --- –í–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ–¥—É–∫—Ç–∞ ---
  if (prod.owners && prod.owners.length) {
    const owner = prod.owners[0];
    const divOwner = document.createElement('div');
    divOwner.className = 'team';

    const titleO = document.createElement('div');
    titleO.style.fontSize = '12px';
    titleO.style.color = '#666';
    titleO.textContent = '–í–ª–∞–¥–µ–ª–µ—Ü:';
    divOwner.appendChild(titleO);

    const a = document.createElement('a');
    a.href = '#';
    a.className = 'owner-link';
    a.dataset.owner = owner.displayName;
    a.style.display = 'flex';
    a.style.alignItems = 'center';
    a.style.gap = '8px';
    a.style.textDecoration = 'none';

    const av = document.createElement('div');
    av.className = 'avatar-sm';
    if (owner.avatarUrl) {
      const im = document.createElement('img');
      im.src = owner.avatarUrl;
      im.alt = owner.displayName || '';
      av.appendChild(im);
    } else {
      av.textContent = owner.displayName ? owner.displayName[0] : '?';
    }
    a.appendChild(av);

¬† ¬† const nameWrap = document.createElement('div');
    nameWrap.className = 'name-wrap';

¬† ¬† const nameSpan = document.createElement('div');
    nameSpan.className = 'tm-name';
    nameSpan.textContent = owner.displayName;
    nameWrap.appendChild(nameSpan);

    if (owner.position) {
      const pos = document.createElement('div');
      pos.className = 'owner-pos';
      pos.textContent = owner.position;
      nameWrap.appendChild(pos);
    }
    a.appendChild(nameWrap);
    divOwner.appendChild(a);
    card.appendChild(divOwner);
  }

  // --- –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ ---
  const list = document.createElement('div');
  list.className = 'team-list';
  if (!prod.teamUsers || prod.teamUsers.length === 0) {
    const t = document.createElement('div');
    t.textContent = '–ö–æ–º–∞–Ω–¥–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
    t.style.fontSize = '13px';
    t.style.color = '#666';
    list.appendChild(t);
  } else {
    prod.teamUsers.forEach(u => {
      const item = document.createElement('div');
      item.className = 'team-item member-link';
      item.dataset.member = u.displayName;
      item.style.cursor = 'pointer';

      const av = document.createElement('div');
      av.className = 'avatar-lg';
      if (u.avatarUrl) {
        const im = document.createElement('img');
        im.src = u.avatarUrl;
        im.alt = u.displayName || '';
        av.appendChild(im);
      } else {
        av.textContent = u.displayName ? u.displayName[0] : '?';
      }
      item.appendChild(av);

      const txt = document.createElement('div');
      txt.className = 'ti-text';

      const nm = document.createElement('div');
      nm.className = 'ti-name';
      nm.textContent = u.displayName;
      txt.appendChild(nm);

      const posPlaceholder = document.createElement('div');
      posPlaceholder.className = 'ti-pos';
      posPlaceholder.textContent = u.position || '';
      txt.appendChild(posPlaceholder);

      item.appendChild(txt);
      list.appendChild(item);
    });
  }
  card.appendChild(list);

  // --- –ù–∏–∂–Ω–∏–π –æ—Ç—Å—Ç—É–ø / meta ---
  const meta = document.createElement('div');
  meta.className = 'card-meta';
  const footer = document.createElement('div');
  footer.style.display = 'flex';
  footer.style.justifyContent = 'space-between';
  footer.style.marginTop = '12px';
  footer.appendChild(meta);
  card.appendChild(footer);

  return card;
}

function renderClusters(groups) {
  contentArea.innerHTML = '';

  groups.forEach(group => {
    const clusterEl = document.createElement('div');
    clusterEl.className = 'cluster';

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å –∫–Ω–æ–ø–∫–æ–π-—Å—Ç—Ä–µ–ª–∫–æ–π
    const head = document.createElement('div');
    head.className = 'cluster-head collapsible-header collapsed';
    head.innerHTML = `
      <span class="arrow"></span>
      <span class="cluster-title">${group.name}</span>
      <span class="cluster-count">${group.items.length} –ø—Ä–æ–¥—É–∫—Ç(–æ–≤)</span>
    `;
    clusterEl.appendChild(head);

    // –û–±—ë—Ä—Ç–∫–∞ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –∫–ª–∞—Å—Ç–µ—Ä–∞ (—Å–≤—ë—Ä–Ω—É—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    const content = document.createElement('div');
    content.className = 'cluster-content collapsed';

    const wrap = document.createElement('div');
    wrap.className = 'cluster-wrap';

    const btnL = document.createElement('button');
    btnL.className = 'scroll-btn left';
    btnL.innerHTML = '<';
    const btnR = document.createElement('button');
    btnR.className = 'scroll-btn right';
    btnR.innerHTML = '>';

    wrap.appendChild(btnL);
    wrap.appendChild(btnR);

    const row = document.createElement('div');
    row.className = 'cluster-row';
    group.items.forEach(it => row.appendChild(createCardFromSimple(it)));
    wrap.appendChild(row);
    content.appendChild(wrap);

    const footer = document.createElement('div');
    footer.className = 'cluster-footer';
    footer.innerHTML = '<div class="note">–ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–π—Ç–µ –≤–±–æ–∫ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞.</div>';
    content.appendChild(footer);

    clusterEl.appendChild(content);
    contentArea.appendChild(clusterEl);

    // –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    function scrollPage(dir) {
      const scrollAmount = row.clientWidth - 24;
      row.scrollBy({ left: dir * scrollAmount, behavior: 'smooth' });
      setTimeout(updateScrollState, 200);
    }
    btnL.addEventListener('click', () => scrollPage(-1));
    btnR.addEventListener('click', () => scrollPage(1));
    function updateScrollState() {
      const hiddenPart = row.scrollWidth - row.clientWidth;
      const atStart = row.scrollLeft <= 2 || hiddenPart <= 0;
      const atEnd = (hiddenPart - row.scrollLeft) <= 2;
      const hasOverflow = hiddenPart > 2;

      btnL.disabled = atStart;
      btnR.disabled = atEnd;

      wrap.classList.toggle('is-scrollable', hasOverflow);
      wrap.classList.toggle('at-start', atStart);
      wrap.classList.toggle('at-end', atEnd);
    }
    const handleScroll = () => updateScrollState();
    row.addEventListener('scroll', handleScroll);
    window.addEventListener('resize', updateScrollState);
    setTimeout(updateScrollState, 120);

    // –∫–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∫–ª–∞—Å—Ç–µ—Ä–∞ (—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞—Å–∫—Ä—ã—Ç–∏–µ)
    head.addEventListener('click', () => {
      head.classList.toggle('collapsed');
      content.classList.toggle('collapsed');
    });
  });
}

// === apply positions into DOM (updates only placeholders) ===
function applyPositionsToDOM(simplified) {
if (!Array.isArray(simplified)) return;
simplified.forEach(prod => {
const entryId = prod.entryId == null ? String(prod.entryId) : String(prod.entryId);
const cardEl = document.querySelector(`.card[data-entry-id="${entryId}"]`);
if (!cardEl) return;

// owner
if (prod.owners && prod.owners.length) {
const owner = prod.owners[0];
const ownerNameEls = Array.from(cardEl.querySelectorAll('.tm-name')).filter(el => el.textContent.trim() === owner.displayName);
if (ownerNameEls.length > 0) {
const ownerNameEl = ownerNameEls[0];
let ownerPosEl = ownerNameEl.parentElement.parentElement.querySelector('.owner-pos');
if (!ownerPosEl) {
ownerPosEl = document.createElement('div');
ownerPosEl.className = 'owner-pos';
ownerPosEl.style.fontSize = '12px';
ownerPosEl.style.color = '#666';
ownerPosEl.style.marginLeft = '8px';
ownerNameEl.parentElement.parentElement.appendChild(ownerPosEl);
}
ownerPosEl.textContent = owner.position || '';
}
}

// team members
if (prod.teamUsers && prod.teamUsers.length) {
prod.teamUsers.forEach(u => {
const tiNameEls = Array.from(cardEl.querySelectorAll('.ti-name')).filter(el => el.textContent.trim() === u.displayName);
tiNameEls.forEach(el => {
const parent = el.parentElement;
let posEl = parent.querySelector('.ti-pos');
if (!posEl) {
posEl = document.createElement('div');
posEl.className = 'ti-pos';
posEl.style.fontSize = '12px';
posEl.style.color = '#444';
posEl.style.fontStyle = 'italic';
posEl.style.marginTop = '2px';
const loginEl = parent.querySelector('.ti-login');
if (loginEl) parent.insertBefore(posEl, loginEl);
else parent.appendChild(posEl);
}
posEl.textContent = u.position || '';
});
});
}
});
}

// === popup showing member products ===
function showPopup(title, items){
popupTitle.textContent = title;
popupList.innerHTML = items.map(i => `<li>${i}</li>`).join('');
popup.style.display = 'block';
}
function hidePopup(){ popup.style.display = 'none'; }

// document click handlers for owner/member links
document.body.addEventListener('click', (e) => {
const ownerEl = e.target.closest('.owner-link');
if (ownerEl) {
e.preventDefault();
const ownerName = ownerEl.dataset.owner;
const list = simplifiedProducts.filter(p => (p.owners || []).some(o => o.displayName === ownerName)).map(p => p.name);
showPopup(`–ü—Ä–æ–¥—É–∫—Ç—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞ ${ownerName}`, list);
return;
}
const memberEl = e.target.closest('.member-link');
if (memberEl) {
e.preventDefault();
const memberName = memberEl.dataset.member;
const list = simplifiedProducts.filter(p => (p.teamUsers || []).some(u => u.displayName === memberName)).map(p => p.name);
showPopup(`–ü—Ä–æ–¥—É–∫—Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫–∞ ${memberName}`, list);
return;
}
if (!popup.contains(e.target)) hidePopup();
});

// --- role mapping machinery ---
// –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —ç—Ç–∏–º–∏ ‚Äî —Å—Ä–∞–∑—É –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
const excludePatterns = [
  /\bbi\b/i,
  /bi[-\s]?–∞–Ω–∞–ª–∏—Ç–∏–∫/i,
  /–ø—Ä–∏–∫–ª–∞–¥–Ω/i,
  /data\s*analyst/i,
  /–∞–Ω–∞–ª–∏—Ç–∏–∫\s*–¥–∞–Ω–Ω—ã—Ö/i
];

// --- role mapping machinery ---
const rolePatterns = {
  analysis: [
    // –≤–∞–∂–Ω–æ ‚Äî —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫ –∏–ª–∏ system analyst
    /\b—Å–∏—Å—Ç–µ–º–Ω(?!.*(bi|–ø—Ä–∏–∫–ª–∞–¥–Ω))/i,
    /system\s*analyst/i
  ],
  dev_1c: [/—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫\s*1—Å/i, /1—Å/i, /1c/i, /—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫\b.*1—Å/i],
  backend: [/\bback[-\s]*end\b/i, /\bC#\b/i, /\b—Å#\b/i, /—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫\b.*C#/i],
  frontend: [/front[-\s]*end/i, /front end/i],
  qa: [/\bqa\b/i, /—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫/i, /quality\s*assurance/i],
  uiux: [/ui\/ux/i, /–¥–∏–∑–∞–π–Ω/i, /designer/i],
  design: [/\b–¥–∏–∑–∞–π–Ω–µ—Ä\b/i, /design(er)?/i],
  consult: [/–∫–æ–Ω—Å—É–ª—å—Ç/i, /consult/i]
};

const roleOrder = ['analysis','dev_1c','backend','frontend','qa','uiux','design','consult','other'];
const roleLabels = {
analysis: '–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑',
dev_1c: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ 1–°',
backend: 'Back-end —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞',
frontend: 'Front-end —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞',
qa: 'QA',
uiux: 'UI/UX',
design: '–î–∏–∑–∞–π–Ω',
consult: '–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã',
other: '–ü—Ä–æ—á–∏–µ'
};
// === –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏ —Ü–µ–Ω—Ç—Ä–æ–≤ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑ ===
const roleLeads = {
  analysis: {
    displayName: "–ë–æ–∂–æ–∫ –û–ª—å–≥–∞",
    login: "bozhok",
    position: "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¶–µ–Ω—Ç—Ä–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞",
    profile: "/secure/ViewProfile.jspa?name=bozhok"
  },
  dev_1c: {
    displayName: "–¢—é–Ω–∏–Ω –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω",
    login: "tyunin",
    position: "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¶–µ–Ω—Ç—Ä–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã 1–°-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏",
    profile: "/secure/ViewProfile.jspa?name=tyunin"
  },
  qa: {
    displayName: "–ù–æ–≤–æ–∂–∏–ª–æ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è",
    login: "novozhilova_a",
    position: "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¶–µ–Ω—Ç—Ä–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (QA)",
    profile: "/secure/ViewProfile.jspa?name=novozhilova_a"
  },
  backend: {
    displayName: "–ß–µ—Ç–≤–µ—Ä–∏–∫–æ–≤ –í–∏—Ç–∞–ª–∏–π",
    login: "chetverikov",
    position: "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¶–µ–Ω—Ç—Ä–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã Back-end —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏",
    profile: "/secure/ViewProfile.jspa?name=chetverikov"
  },
  frontend: {
    displayName: "–ó—É–±—Ü–æ–≤ –°–µ—Ä–≥–µ–π",
    login: "zubtsov",
    position: "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¶–µ–Ω—Ç—Ä–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã Front-end —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏",
    profile: "/secure/ViewProfile.jspa?name=zubtsov"
  },
  uiux: {
    displayName: "–ï—Ñ—Ä–µ–º–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä",
    login: "efremov_aa",
    position: "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –¶–µ–Ω—Ç—Ä–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã UI/UX",
    profile: "/secure/ViewProfile.jspa?name=efremov_aa"
  }
};

function mapPositionToRole(pos) {
if (!pos || !pos.trim()) return 'other';
const s = pos.toLowerCase();
for (const [role, patterns] of Object.entries(rolePatterns)) {
for (const p of patterns) {
if (p.test(s)) return role;
}
}
if (/\bteam[-\s]?lead\b/i.test(pos) || /—Ç–∏–º-?–ª–∏–¥/i.test(pos) || /teamlead/i.test(pos)) {
if (/\bC#\b/i.test(pos) || /back[-\s]*end/i.test(pos)) return 'backend';
if (/front[-\s]*end/i.test(pos) || /front/i.test(pos)) return 'frontend';
if (/1—Å|1c/i.test(pos)) return 'dev_1c';
return 'dev_1c';
}
if (/qa/i.test(pos) && /lead|–ª–∏–¥/i.test(pos)) return 'qa';
if (/—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫|developer|dev/i.test(pos)) {
if (/\bC#\b/i.test(pos) || /back[-\s]*end/i.test(pos)) return 'backend';
if (/front[-\s]*end|front/i.test(pos)) return 'frontend';
if (/1—Å|1c/i.test(pos)) return 'dev_1c';
return 'backend';
}
// --- –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ ---
if (/–∞–Ω–∞–ª–∏—Ç–∏–∫/i.test(pos)) {
  // –∏—Å–∫–ª—é—á–∞–µ–º BI, –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
  if (/(bi[\s-]?–∞–Ω–∞–ª–∏—Ç–∏–∫|–∞–Ω–∞–ª–∏—Ç–∏–∫\s*(bi|–¥–∞–Ω–Ω—ã—Ö)|–ø—Ä–∏–∫–ª–∞–¥–Ω)/i.test(pos)) return 'other';
  if (/—Å–∏—Å—Ç–µ–º–Ω/i.test(pos) || /system\s*analyst/i.test(pos)) return 'analysis';
  return 'other'; // –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ ‚Äî "–ø—Ä–æ—á–∏–µ"
}
if (/—Ç–µ—Å—Ç|qa|quality/i.test(pos)) return 'qa';
if (/ui|ux|–¥–∏–∑–∞–π–Ω|designer/i.test(pos)) return 'uiux';
return 'other';
}

// build roles map grouped by owner
function buildRolesByOwner(simplifiedProducts) {
const rolesMap = {}; // roleKey -> Map(ownerKey -> { owner:{}, members: Map(...) })
simplifiedProducts.forEach(p => {
const prodName = p.name;
const owners = (p.owners && p.owners.length) ? p.owners : [{ displayName: '–ë–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–∞', avatarUrl: '', profile: '' }];
const members = p.teamUsers || [];
owners.forEach(owner => {
const ownerKey = owner.displayName || '–ë–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–∞';
members.forEach(member => {
const roleKey = mapPositionToRole(member.position || '');
rolesMap[roleKey] = rolesMap[roleKey] || new Map();
if (!rolesMap[roleKey].has(ownerKey)) {
rolesMap[roleKey].set(ownerKey, {
owner: { displayName: owner.displayName || ownerKey, avatarUrl: owner.avatarUrl || '', profile: owner.profile || '' },
members: new Map()
});
}
const ownerEntry = rolesMap[roleKey].get(ownerKey);
const memberKey = member.displayName || (member.name || 'unknown');
if (!ownerEntry.members.has(memberKey)) {
ownerEntry.members.set(memberKey, {
displayName: member.displayName || memberKey,
position: member.position || '',
avatarUrl: member.avatarUrl || '',
profile: member.profile || '',
products: new Set()
});
}
ownerEntry.members.get(memberKey).products.add(prodName);
});
});
});
return rolesMap;
}

function findCardsByProductName(prodName) {
const matches = [];
const cards = Array.from(document.querySelectorAll('.card'));
const target = (prodName || '').trim().toLowerCase();
cards.forEach(card => {
const titleEl = card.querySelector('.card-title');
if (!titleEl) return;
if ((titleEl.textContent||'').trim().toLowerCase() === target) matches.push(card);
});
return matches;
}
function clearHighlights() {
document.querySelectorAll('.card.highlight').forEach(el => el.classList.remove('highlight'));
}
function highlightProductsByNames(names) {
clearHighlights();
names.forEach(n => {
findCardsByProductName(n).forEach(c => c.classList.add('highlight'));
});
const first = document.querySelector('.card.highlight');
if (first) first.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

// === buildRolesByOwnerGrouped: —Ç–µ–ø–µ—Ä—å –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å ‚Äî –†–æ–ª—å, –≤–Ω—É—Ç—Ä–∏ ‚Äî –ö–ª–∞—Å—Ç–µ—Ä—ã ===
function buildRolesByOwnerGrouped(products) {
  const roles = {}; // role -> cluster -> owner -> members

  products.forEach(p => {
    const prodName = p.name;
    const cluster = p.cluster || '–ë–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞';
    const owners = (p.owners && p.owners.length) ? p.owners : [{ displayName: '–ë–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–∞', avatarUrl: '', profile: '' }];
    const members = p.teamUsers || [];

    owners.forEach(owner => {
      members.forEach(member => {
        const roleKey = mapPositionToRole(member.position || '');
        if (!roles[roleKey]) roles[roleKey] = {};
        if (!roles[roleKey][cluster]) roles[roleKey][cluster] = new Map();

        const clusterMap = roles[roleKey][cluster];
        const ownerKey = owner.displayName || '–ë–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–∞';
        if (!clusterMap.has(ownerKey)) {
          clusterMap.set(ownerKey, {
            owner: {
              displayName: owner.displayName || ownerKey,
              avatarUrl: owner.avatarUrl || '',
              profile: owner.profile || ''
            },
            members: new Map()
          });
        }

        const ownerEntry = clusterMap.get(ownerKey);
        const memberKey = member.displayName || (member.name || 'unknown');
        if (!ownerEntry.members.has(memberKey)) {
          ownerEntry.members.set(memberKey, {
            displayName: member.displayName || memberKey,
            position: member.position || '',
            avatarUrl: member.avatarUrl || '',
            profile: member.profile || '',
            products: new Set()
          });
        }
        ownerEntry.members.get(memberKey).products.add(prodName);
      });
    });
  });

  return roles;
}

function renderByRoles() {
  contentArea.innerHTML = '';
  const rolesGrouped = buildRolesByOwnerGrouped(simplifiedProducts);

  roleOrder.forEach(roleKey => {
    const clustersMap = rolesGrouped[roleKey];
    if (!clustersMap || Object.keys(clustersMap).length === 0) return;

    const roleSection = document.createElement('div');
    roleSection.className = 'role-section';

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–æ–ª–∏
    const header = document.createElement('h4');
¬† ¬† // —Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è —ç—Ç–æ–π —Ä–æ–ª–∏
let uniqueMembers = new Set();
Object.values(clustersMap).forEach(ownersMap => {
  Array.from(ownersMap.values()).forEach(ownerEntry => {
    Array.from(ownerEntry.members.values()).forEach(member => {
      uniqueMembers.add(member.displayName || member.name || '');
    });
  });
});
header.textContent = `${roleLabels[roleKey]} (${uniqueMembers.size} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫${uniqueMembers.size % 10 === 1 && uniqueMembers.size % 100 !== 11 ? '' : (uniqueMembers.size % 10 >= 2 && uniqueMembers.size % 10 <= 4 && (uniqueMembers.size % 100 < 10 || uniqueMembers.size % 100 >= 20) ? '–∞' : '–æ–≤')})`;
¬† ¬† header.classList.add('collapsible-header');
    roleSection.appendChild(header);

    // –ö–æ–Ω—Ç–µ–Ω—Ç —Ä–æ–ª–∏ (—Å–≤—ë—Ä–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    const content = document.createElement('div');
    content.className = 'role-content collapsed';
// --- –µ—Å–ª–∏ –µ—Å—Ç—å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤–µ—Ä—Ö—É ---
const lead = roleLeads[roleKey];
if (lead) {
  const leadBlock = document.createElement('div');
  leadBlock.className = 'owner-block';
  leadBlock.style.background = '#f0f6ff';
  leadBlock.style.border = '1px solid #cdddfd';
  leadBlock.style.display = 'flex';
  leadBlock.style.alignItems = 'center';
  leadBlock.style.gap = '12px';

  const avatar = document.createElement('div');
  avatar.className = 'member-avatar';
  avatar.textContent = lead.displayName.split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase();

  // --- –ø—Ä–æ–±—É–µ–º —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å –∞–≤–∞—Ç–∞—Ä –∏–∑ Confluence ---
  const avatarUrl = `/download/attachments/138413176/user-${lead.login}-ldap-image.png`;
  const testImg = new Image();
  testImg.onload = () => {
    avatar.innerHTML = `<a href="${lead.profile}" target="_blank"><img src="${avatarUrl}" 
      style="width:100%;height:100%;object-fit:cover;border-radius:50%;"></a>`;
  };
  testImg.onerror = () => {
    // –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –ø—Ä–æ–±—É–µ–º –≤—ã—Ç–∞—â–∏—Ç—å –∏–∑ Jira –ø—Ä–æ—Ñ–∏–ª—è —á–µ—Ä–µ–∑ proxy
    fetch(buildProfileProxyUrl(lead.profile))
      .then(r => r.text())
      .then(html => {
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const img = doc.querySelector('.user-photo img, .avatar img');
        if (img && img.src) {
          avatar.innerHTML = `<a href="${lead.profile}" target="_blank"><img src="${img.src}" 
            style="width:100%;height:100%;object-fit:cover;border-radius:50%;"></a>`;
        }
      })
      .catch(()=>{});
  };
  testImg.src = avatarUrl;

  const meta = document.createElement('div');
  meta.className = 'owner-meta';
  meta.innerHTML = `
    <div class="o-name">${lead.displayName}</div>
    <div class="m-pos">${lead.position}</div>
    <div class="o-count"><a href="${lead.profile}" target="_blank" style="color:#0b69ff;text-decoration:none;">–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a></div>
  `;

  leadBlock.appendChild(avatar);
  leadBlock.appendChild(meta);
  content.appendChild(leadBlock);
}
¬† ¬† Object.entries(clustersMap).forEach(([clusterName, ownersMap]) => {
      const clusterBlock = document.createElement('div');
      clusterBlock.className = 'cluster-block';

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞ (—Å–æ —Å—Ç—Ä–µ–ª–∫–æ–π —Å–ª–µ–≤–∞)
      const ch = document.createElement('div');
      ch.className = 'cluster-head collapsible-header';
      ch.innerHTML = `<span class="arrow"></span><span class="cluster-name">${clusterName}</span>`;
      ch.classList.add('collapsed'); // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ
¬† ¬† ¬† clusterBlock.appendChild(ch);

      // –ö–æ–Ω—Ç–µ–Ω—Ç –∫–ª–∞—Å—Ç–µ—Ä–∞ (—Ç–æ–∂–µ —Å–≤—ë—Ä–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
      const clusterContent = document.createElement('div');
      clusterContent.className = 'cluster-content collapsed';

      Array.from(ownersMap.entries()).forEach(([ownerKey, ownerEntry]) => {
        const ob = document.createElement('div');
        ob.className = 'owner-block';

        // –∞–≤–∞—Ç–∞—Ä –≤–ª–∞–¥–µ–ª—å—Ü–∞
        const avatarWrap = document.createElement('div');
        avatarWrap.className = 'member-avatar';
        if (ownerEntry.owner.avatarUrl) {
          const link = document.createElement('a');
          link.href = ownerEntry.owner.profile || '#';
          link.target = '_blank';
          link.rel = 'noopener noreferrer';
          const img = document.createElement('img');
          img.src = ownerEntry.owner.avatarUrl;
          img.alt = ownerEntry.owner.displayName || '';
          link.appendChild(img);
          avatarWrap.appendChild(link);
        } else {
          const initials = (ownerEntry.owner.displayName || '').split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase() || '?';
          avatarWrap.textContent = initials;
        }
        ob.appendChild(avatarWrap);

        // –∏–Ω—Ñ–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞
        const meta = document.createElement('div');
        meta.className = 'owner-meta';
        const oname = document.createElement('div');
        oname.className = 'o-name';
        oname.textContent = ownerEntry.owner.displayName;
        const ocount = document.createElement('div');
        ocount.className = 'o-count';
        ocount.textContent = `${ownerEntry.members.size} —É—á–∞—Å—Ç–Ω–∏–∫(–æ–≤)`;
        meta.appendChild(oname);
        meta.appendChild(ocount);
        ob.appendChild(meta);

        // —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        const membersWrap = document.createElement('div');
        membersWrap.style.flex = '1';
        Array.from(ownerEntry.members.values())
          .sort((a, b) => a.displayName.localeCompare(b.displayName))
          .forEach(member => {
            const mr = document.createElement('div');
            mr.className = 'member-row';
            mr.style.justifyContent = 'space-between';

            const left = document.createElement('div');
            left.style.display = 'flex';
            left.style.gap = '12px';
            left.style.alignItems = 'center';

            const mavatar = document.createElement('div');
            mavatar.className = 'member-avatar';
            if (member.avatarUrl) {
              const lnk = document.createElement('a');
              lnk.href = member.profile || '#';
              lnk.target = '_blank';
              lnk.rel = 'noopener noreferrer';
              const img = document.createElement('img');
              img.src = member.avatarUrl;
              img.alt = member.displayName || '';
              lnk.appendChild(img);
              mavatar.appendChild(lnk);
            } else {
              const initials = (member.displayName || '').split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase() || '?';
              mavatar.textContent = initials;
            }
            left.appendChild(mavatar);

            const minfo = document.createElement('div');
            const mname = document.createElement('div');
            mname.className = 'm-name';
            mname.textContent = member.displayName;
            minfo.appendChild(mname);
            if (member.position) {
              const mpos = document.createElement('div');
              mpos.className = 'm-pos';
              mpos.textContent = member.position;
              minfo.appendChild(mpos);
            }
            left.appendChild(minfo);
            mr.appendChild(left);

            const prods = document.createElement('div');
            prods.className = 'member-prods';
            Array.from(member.products).forEach(prodName => {
              const a = document.createElement('a');
              a.href = '#';
              a.textContent = prodName;
              a.addEventListener('click', ev => {
                ev.preventDefault();
                highlightProductsByNames([prodName]);
              });
              prods.appendChild(a);
            });
            mr.appendChild(prods);
            membersWrap.appendChild(mr);
          });

        ob.appendChild(membersWrap);
        clusterContent.appendChild(ob);
      });

      clusterBlock.appendChild(clusterContent);
      content.appendChild(clusterBlock);

      // –∫–ª–∏–∫ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä—É (—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ)
      ch.addEventListener('click', () => {
        clusterContent.classList.toggle('collapsed');
        ch.classList.toggle('collapsed');
      });
    });

    // –∫–ª–∏–∫ –ø–æ —Ä–æ–ª–∏ (—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ)
    header.addEventListener('click', () => {
      content.classList.toggle('collapsed');
      header.classList.toggle('collapsed');
    });

    roleSection.appendChild(content);
    contentArea.appendChild(roleSection);
  });

  const footer = document.createElement('div');
  footer.className = 'cluster-footer';
  const note = document.createElement('div');
  note.className = 'note';
  note.textContent = '–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç, —á—Ç–æ–±—ã –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤.';
  footer.appendChild(note);
  contentArea.appendChild(footer);
}

// === –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: fetch -> build simplified -> render immediately -> enrich positions in background -> apply positions ===
try {
allEntries = await fetchAll();
simplifiedProducts = buildSimplified(allEntries);

// 1) —Å–Ω–∞—á–∞–ª–∞ –±—ã—Å—Ç—Ä—ã–π —Ä–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫
renderClusters(groupByCluster(simplifiedProducts));

// 2) –∑–∞—Ç–µ–º –≤ —Ñ–æ–Ω–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –∫ DOM (–Ω–µ –±–ª–æ–∫–∏—Ä—É—è UI)
enrichPositionsInSimplified(simplifiedProducts)
.then(() => {
try { applyPositionsToDOM(simplifiedProducts); } catch(e){ console.warn(e); }
})
.catch(e => console.warn('–û—à–∏–±–∫–∞ –ø–æ–¥–≥—Ä—É–∑–∫–∏ –ø–æ–∑–∏—Ü–∏–π', e));
} catch (err) {
root.innerHTML = '<div class="error">–û—à–∏–±–∫–∞: ' + (err.message || err) + '</div>';
console.error(err);
}

// –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤: –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω roles –∏ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã - –ø–æ–¥–≥—Ä—É–∂–∞–µ–º
document.getElementById('viewMode').addEventListener('change', async (e) => {
if (e.target.value === 'roles') {
if (!positionsLoaded) {
positionsLoaderEl.style.display = 'inline';
try {
await enrichPositionsInSimplified(simplifiedProducts);
applyPositionsToDOM(simplifiedProducts);
} catch (ex) { console.warn(ex); }
positionsLoaderEl.style.display = 'none';
}
renderByRoles();
} else {
renderClusters(groupByCluster(simplifiedProducts));
}
});

// helper grouping
function groupByCluster(simpleProducts){
const groups = [];
const map = new Map();
simpleProducts.forEach(p => {
const name = p.cluster || '–ë–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞';
if (!map.has(name)) map.set(name, []);
map.get(name).push(p);
});
clusterOrder.forEach(k => { if (map.has(k)) { groups.push({ name:k, items: map.get(k) }); map.delete(k); }});
for (const [k, items] of map.entries()) groups.push({ name:k, items });
return groups;
}

})();
</script>




<!-- CENTERS OF EXPERTISE -->
<div class="centers-block">
  <h2>–¶–µ–Ω—Ç—Ä—ã —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã</h2>
  <p>
    –ú–∞—Ç—Ä–∏—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç–∫—Å–ø–µ—Ä—Ç–∞–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö, –ø–æ–ª—É—á–∞—è —Ä–∞–∑–≤–∏—Ç–∏–µ, –æ–±—É—á–µ–Ω–∏–µ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –æ—Ç —Å–≤–æ–µ–≥–æ –¶–µ–Ω—Ç—Ä–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã.
  </p>

  <div class="centers-wrapper">
    <a href="https://wiki.sminex.com/pages/viewpage.action?pageId=95489150" target="_blank" class="center-card">
      <h3>–¶–µ–Ω—Ç—Ä Backend</h3>
      <p>–≠–∫—Å–ø–µ—Ä—Ç—ã –ø–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.</p>
    </a>

    <a href="https://wiki.sminex.com/pages/viewpage.action?pageId=129470754" target="_blank" class="center-card">
      <h3>–¶–µ–Ω—Ç—Ä –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ 1–°</h3>
      <p>–≠–∫—Å–ø–µ—Ä—Ç—ã –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ä–µ—à–µ–Ω–∏–π –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ 1–° –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.</p>
    </a>

    <a href="https://wiki.sminex.com/pages/viewpage.action?pageId=116443137" target="_blank" class="center-card">
      <h3>–¶–µ–Ω—Ç—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</h3>
      <p>–≠–∫—Å–ø–µ—Ä—Ç—ã –ø–æ –∞–Ω–∞–ª–∏–∑—É –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Ä–µ—à–µ–Ω–∏–π, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–µ —Ç–æ—á–Ω–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å IT-—Ä–∞–∑—Ä–∞–±–æ—Ç–æ–∫.</p>
    </a>

    <a href="https://wiki.sminex.com/display/FR/Definition+of+Done" target="_blank" class="center-card">
      <h3>–¶–µ–Ω—Ç—Ä Frontend</h3>
      <p>–≠–∫—Å–ø–µ—Ä—Ç—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.</p>
    </a>

    <a href="https://wiki.sminex.com/pages/viewpage.action?pageId=116450676" target="_blank" class="center-card">
      <h3>–¶–µ–Ω—Ç—Ä QA</h3>
      <p>–≠–∫—Å–ø–µ—Ä—Ç—ã –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é.</p>
    </a>

    <a href="https://wiki.sminex.com/pages/viewpage.action?pageId=116450804" target="_blank" class="center-card">
      <h3>–¶–µ–Ω—Ç—Ä UI/UX</h3>
      <p>–≠–∫—Å–ø–µ—Ä—Ç—ã –ø–æ –¥–∏–∑–∞–π–Ω—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º—É –æ–ø—ã—Ç—É.</p>
    </a>

    <a href="https://wiki.sminex.com/pages/viewpage.action?pageId=146413521" target="_blank" class="center-card">
      <h3>–¶–µ–Ω—Ç—Ä —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø–∏—Å–∞—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
      <p>–≠–∫—Å–ø–µ—Ä—Ç—ã –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –Ω–∞–ø–∏—Å–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.</p>
    </a>

    <a href="https://wiki.sminex.com/pages/viewpage.action?pageId=116433781" target="_blank" class="center-card">
      <h3>–¶–µ–Ω—Ç—Ä PO</h3>
      <p>–≠–∫—Å–ø–µ—Ä—Ç—ã –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ–¥—É–∫—Ç–æ–º –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é —Å –±–∏–∑–Ω–µ—Å-–ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º–∏.</p>
    </a>
  </div>
</div>

<style>
#stech-root .centers-block {
  padding:80px 20px;
  max-width:1100px;
  margin:0 auto;
  text-align:center;
  background:linear-gradient(180deg, #ffffff 0%, #f7f7f8 100%);
}

#stech-root .centers-block h2 {
  font-size:36px;
  font-weight:600;
  margin-bottom:10px;
}

#stech-root .centers-block p {
  font-size:18px;
  color:#6e6e73;
  margin-bottom:50px;
  max-width:700px;
  margin-left:auto;
  margin-right:auto;
}

/* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
#stech-root .centers-wrapper {
  display:flex;
  overflow-x:auto;
  gap:20px;
  padding-bottom:10px;
  scrollbar-width:thin;
  scrollbar-color:#007AFF rgba(0,0,0,0.1);
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
#stech-root .center-card {
  flex:0 0 280px;
  background:white;
  border-radius:20px;
  padding:25px;
  box-shadow:0 8px 25px rgba(0,0,0,0.05);
  text-align:left;
  transition:transform 0.2s, box-shadow 0.2s;
  text-decoration:none;
  color:inherit;
}

#stech-root .center-card:hover {
  transform: translateY(-8px);
  box-shadow:0 12px 40px rgba(0,0,0,0.1);
}

/* –°–∫—Ä–æ–ª–ª Firefox */
#stech-root .centers-wrapper {
  scrollbar-width: thin;
  scrollbar-color: #007AFF rgba(0,0,0,0.1);
}

/* –°–∫—Ä–æ–ª–ª Chrome, Edge, Safari */
.centers-wrapper::-webkit-scrollbar {
  height: 8px;
}

.centers-wrapper::-webkit-scrollbar-thumb {
  background-color: #007AFF;
  border-radius: 4px;
}

.centers-wrapper::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.05);
}
</style>
<!-- HEADER PlayBook --> <div style="text-align:center; padding:40px 20px; background:linear-gradient(180deg, #ffffff 0%, #f2f2f3 100%); position:relative; overflow:hidden; display:flex; justify-content:space-between; align-items:center; max-width:1100px; margin:0 auto;"> <!-- –õ–µ–≤—ã–π –±–ª–æ–∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞ --> <div style="flex:1; text-align:left; position:relative;"> <h1 style="font-size:48px; font-weight:600; margin-bottom:20px; letter-spacing:-0.5px; line-height:1.2;"> PlayBook<br> <span style="background: linear-gradient(90deg, #007AFF, #1D1D1F); -webkit-background-clip: text; color: transparent;"> Sminex.tech </span> </h1> <p style="font-size:20px; color:#6e6e73; max-width:500px; margin-bottom:40px;"> –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã IT-–∫–æ–º–∞–Ω–¥ Sminex.tech –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ </p> <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ PlayBook --> <a href="https://wiki.sminex.com/display/SMTE/PlayBook+Sminex+Tech" style="display:inline-block; padding:15px 35px; font-size:18px; font-weight:600; color:white; background: linear-gradient(90deg, #007AFF, #1D1D1F); border-radius:12px; text-decoration:none; box-shadow:0 8px 20px rgba(0,0,0,0.15); transition: transform 0.2s, box-shadow 0.2s;"> –ü–µ—Ä–µ–π—Ç–∏ –≤ PlayBook </a> </div> <!-- –ü—É—Å—Ç–æ–π –ø—Ä–∞–≤—ã–π –±–ª–æ–∫ (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞) --> <div style="flex:0 0 320px;"></div> </div>
<!-- üîÅ –†–ï–õ–ò–ó–ù–´–ô –¶–ò–ö–õ + –ö–ê–õ–ï–ù–î–ê–†–¨ –°–ü–†–ò–ù–¢–û–í -->
<div class="sprints-block">

  <div class="sprints-decor-top"></div>
  <div class="sprints-decor-bottom"></div>

  <h2>–†–µ–ª–∏–∑–Ω—ã–π —Ü–∏–∫–ª –∏ —Å–ø—Ä–∏–Ω—Ç—ã</h2>
  <p>
    –ö–æ–º–∞–Ω–¥—ã <strong>Sminex.tech</strong> —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ –¥–≤—É—Ö–Ω–µ–¥–µ–ª—å–Ω—ã–º —Å–ø—Ä–∏–Ω—Ç–∞–º, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è –∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –ø—Ä–æ–¥—É–∫—Ç–æ–≤.  
    –ö–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é, —Å <strong>—á–µ—Ç–≤–µ—Ä–≥–∞ –Ω–∞ –ø—è—Ç–Ω–∏—Ü—É</strong>, –º—ã –≤—ã–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å –Ω–∞—à–µ–≥–æ —Ä–µ–ª–∏–∑–Ω–æ–≥–æ —Ü–∏–∫–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞—à–∏—Ö —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π.
  </p>

  <div class="progress-line">
    <div class="progress-bar"></div>
  </div>

  <div class="sprints-layout">
    <div class="calendar-container">
      <div class="calendar-nav">
        <button id="prevMonth"><</button>
        <span id="monthTitle"></span>
        <button id="nextMonth">></button>
      </div>
      <div id="calendar"></div>
      <div class="calendar-legend">
        <span class="legend-sprint"></span> –°–ø—Ä–∏–Ω—Ç
        <span class="legend-today"></span> –°–µ–≥–æ–¥–Ω—è
      </div>
    </div>

    <div id="sprint-container" class="sprints-grid"></div>
  </div>

</div>

<style>
/* === –û–±—â–∏–µ —Å—Ç–∏–ª–∏ === */
#stech-root .sprints-block { max-width:1100px; margin:80px auto; font-family:'Inter', Arial, sans-serif; position:relative; overflow:hidden; border-radius:20px; background:linear-gradient(180deg, #ffffff 0%, #f7f8fa 100%); box-shadow:0 8px 30px rgba(0,0,0,0.05); padding:60px 40px; }
#stech-root .sprints-decor-top { position:absolute; top:-40px; right:-40px; width:160px; height:160px; border-radius:50%; background:radial-gradient(circle at center, rgba(0,122,255,0.15) 0%, transparent 70%); }
#stech-root .sprints-decor-bottom { position:absolute; bottom:-60px; left:-60px; width:200px; height:200px; border-radius:50%; background:radial-gradient(circle at center, rgba(0,0,0,0.05) 0%, transparent 70%); }

#stech-root .sprints-block h2 { text-align:center; margin-bottom:20px; font-size:36px; font-weight:600; color:#1D1D1F; }
#stech-root .sprints-block p { text-align:center; color:#6E6E73; font-size:18px; max-width:800px; margin:0 auto 50px; }

#stech-root .progress-line { display:flex; justify-content:center; margin-bottom:50px; }
#stech-root .progress-line > .progress-bar { width:80%; height:6px; background:#E5E5EA; border-radius:3px; position:relative; overflow:hidden; }
#stech-root .progress-line > .progress-bar::after { content:''; display:block; width:45%; height:100%; background:linear-gradient(90deg, #007AFF, #1D1D1F); border-radius:3px; animation:progressPulse 2s infinite alternate; }
@keyframes progressPulse { 0% {opacity:0.7;} 100% {opacity:1;} }

/* === –ö–∞–ª–µ–Ω–¥–∞—Ä—å + —Å–ø—Ä–∏–Ω—Ç—ã === */
#stech-root .sprints-layout { display:flex; gap:40px; justify-content:center; flex-wrap:wrap; }
#stech-root .calendar-container { background:#f9fafb; border-radius:24px; box-shadow:0 8px 24px rgba(0,0,0,0.08); padding:20px 28px; width:360px; min-width:360px; box-sizing:border-box; }
#stech-root .calendar-nav { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
#stech-root .calendar-nav button { border:none; background:#007aff; color:white; font-size:16px; padding:6px 12px; border-radius:8px; cursor:pointer; }
#stech-root .calendar-nav button:hover { background:#005ecb; }

/* –°–µ—Ç–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
#stech-root .calendar-header { display:grid; grid-template-columns:repeat(7,1fr); text-align:center; font-weight:600; color:#6e6e73; margin-bottom:6px; }
#stech-root .calendar-grid { display:grid; grid-template-columns:repeat(7,1fr); grid-auto-rows:40px; gap:6px; text-align:center; font-size:14px; }
#stech-root .calendar-day { display:flex; align-items:center; justify-content:center; border-radius:10px; transition:0.2s; position:relative; box-sizing:border-box; width:100%; height:100%; }
#stech-root .calendar-day.prevMonth, #stech-root .calendar-day.nextMonth { color:#a0a0a0; }

/* –ì—Ä–∞–¥–∏–µ–Ω—Ç —Å–ø—Ä–∏–Ω—Ç–∞ */
#stech-root .calendar-day.sprint { background: linear-gradient(90deg, #007aff20 0%, #007aff05 50%, #007aff20 100%); }

/* –°–µ–≥–æ–¥–Ω—è */
#stech-root .calendar-day.current { background:#007aff; color:white; font-weight:700; border:2px solid #004bb5; box-shadow:0 0 8px rgba(0,122,255,0.4); z-index:2; position:relative; }

/* –ï—Å–ª–∏ –¥–µ–Ω—å –∏ —Å–µ–≥–æ–¥–Ω—è, –∏ —Å–ø—Ä–∏–Ω—Ç ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å—Ç–∏–ª–∏ */
#stech-root .calendar-day.sprint.current {
  background: linear-gradient(135deg, #007aff 0%, #007aff20 100%);
  color:white;
  font-weight:700;
  border:2px solid #004bb5;
  box-shadow:0 0 8px rgba(0,122,255,0.4);
}

/* –õ–µ–≥–µ–Ω–¥–∞ */
#stech-root .calendar-legend { margin-top:12px; font-size:14px; display:flex; gap:12px; align-items:center; }
#stech-root .legend-sprint { display:inline-block; width:16px; height:16px; background:linear-gradient(90deg, #007aff20 0%, #007aff05 50%, #007aff20 100%); border-radius:4px; }
#stech-root .legend-today { display:inline-block; width:16px; height:16px; background:#007aff; border-radius:4px; }

/* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å–ø—Ä–∏–Ω—Ç–æ–≤ */
#stech-root .sprints-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:20px; max-height:500px; overflow-y:auto; }
#stech-root .sprint-card { background:white; border:1px solid #e0e0e0; border-radius:16px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.05); transition:transform 0.3s, box-shadow 0.3s; cursor:pointer; display:flex; justify-content:space-between; align-items:center; gap:20px; }
#stech-root .sprint-card:hover { transform:translateY(-4px); box-shadow:0 8px 20px rgba(0,0,0,0.1); }
#stech-root .sprint-card .status { font-weight:600; font-size:16px; display:flex; align-items:center; gap:6px; }
#stech-root .status.completed { color:#8e8e93; }
#stech-root .status.active { color:#007aff; }
#stech-root .status.upcoming { color:#34c759; }
</style>

<script>
const sprints = [
  { num:"1.4.25", start:"29.09.2025", end:"10.10.2025" },
  { num:"2.4.25", start:"13.10.2025", end:"24.10.2025" },
  { num:"3.4.25", start:"27.10.2025", end:"07.11.2025" },
  { num:"4.4.25", start:"10.11.2025", end:"21.11.2025" },
  { num:"5.4.25", start:"24.11.2025", end:"05.12.2025" },
  { num:"6.4.25", start:"08.12.2025", end:"19.12.2025" },
  { num:"7.4.25", start:"22.12.2025", end:"30.12.2025" },
  { num:"1.1.26", start:"12.01.2026", end:"23.01.2026" },
  { num:"2.1.26", start:"26.01.2026", end:"06.02.2026" },
  { num:"3.1.26", start:"09.02.2026", end:"20.02.2026" },
  { num:"4.1.26", start:"23.02.2026", end:"06.03.2026" },
  { num:"5.1.26", start:"09.03.2026", end:"20.03.2026" },
  { num:"6.1.26", start:"23.03.2026", end:"03.04.2026" },
  { num:"1.2.26", start:"06.04.2026", end:"17.04.2026" },
  { num:"2.2.26", start:"20.04.2026", end:"01.05.2026" },
  { num:"3.2.26", start:"04.05.2026", end:"15.05.2026" },
  { num:"4.2.26", start:"18.05.2026", end:"29.05.2026" },
  { num:"5.2.26", start:"01.06.2026", end:"12.06.2026" },
  { num:"6.2.26", start:"15.06.2026", end:"26.06.2026" },
  { num:"1.3.26", start:"29.06.2026", end:"10.07.2026" },
  { num:"2.3.26", start:"13.07.2026", end:"24.07.2026" },
  { num:"3.3.26", start:"27.07.2026", end:"07.08.2026" },
  { num:"4.3.26", start:"10.08.2026", end:"21.08.2026" },
  { num:"5.3.26", start:"24.08.2026", end:"04.09.2026" },
  { num:"6.3.26", start:"07.09.2026", end:"18.09.2026" },
  { num:"7.3.26", start:"21.09.2026", end:"02.10.2026" },
  { num:"1.4.26", start:"05.10.2026", end:"16.10.2026" },
  { num:"2.4.26", start:"19.10.2026", end:"30.10.2026" },
  { num:"3.4.26", start:"02.11.2026", end:"13.11.2026" },
  { num:"4.4.26", start:"16.11.2026", end:"27.11.2026" },
  { num:"5.4.26", start:"30.11.2026", end:"11.12.2026" },
  { num:"6.4.26", start:"14.12.2026", end:"30.12.2026" }
];

const today = new Date();
const sprintContainer = document.getElementById('sprint-container');
const calendarEl = document.getElementById('calendar');
const monthTitle = document.getElementById('monthTitle');
const monthSet = new Set();

function addMonth(date){
  const monthKey = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}`;
  if(!monthSet.has(monthKey)) monthSet.add(monthKey);
}

sprints.forEach(({start,end}) => {
  addMonth(formatDate(start));
  addMonth(formatDate(end));
});

const months = Array.from(monthSet)
  .map(key => {
    const [year, month] = key.split('-').map(Number);
    return { month, year };
  })
  .sort((a, b) => (a.year === b.year ? a.month - b.month : a.year - b.year));

let currentMonthIndex = Math.max(0, months.findIndex(({month, year}) => {
  return month === today.getMonth()+1 && year === today.getFullYear();
}));
let selectedSprint = null;

function formatDate(dateStr){ const [d,m,y]=dateStr.split('.').map(Number); return new Date(y,m-1,d); }
function getSprintStatus(sprint){ const start=formatDate(sprint.start), end=formatDate(sprint.end); if(today>end) return "completed"; if(today>=start && today<=end) return "active"; return "upcoming"; }

function createCalendar(sprint){
  if(!months.length) return;
  const { month, year } = months[currentMonthIndex];
  const start = new Date(year, month-1,1);
  const daysInMonth = new Date(year, month,0).getDate();
  const monthNames = ["–Ø–Ω–≤–∞—Ä—å","–§–µ–≤—Ä–∞–ª—å","–ú–∞—Ä—Ç","–ê–ø—Ä–µ–ª—å","–ú–∞–π","–ò—é–Ω—å","–ò—é–ª—å","–ê–≤–≥—É—Å—Ç","–°–µ–Ω—Ç—è–±—Ä—å","–û–∫—Ç—è–±—Ä—å","–ù–æ—è–±—Ä—å","–î–µ–∫–∞–±—Ä—å"];
  monthTitle.textContent = `${monthNames[month-1]} ${year}`;

  let html=`<div class="calendar-header"><div>–ü–Ω</div><div>–í—Ç</div><div>–°—Ä</div><div>–ß—Ç</div><div>–ü—Ç</div><div>–°–±</div><div>–í—Å</div></div><div class="calendar-grid">`;

  const firstDayIndex = (start.getDay()+6)%7;
  const prevMonthDays = new Date(year, month-1,0).getDate();

  // –ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü
  for(let i=firstDayIndex-1;i>=0;i--){
    const dayNum = prevMonthDays - i;
    const date = new Date(year, month-2, dayNum);
    let cls="calendar-day prevMonth";
    if(sprint && date>=formatDate(sprint.start) && date<=formatDate(sprint.end)) cls+=" sprint";
    if(date.toDateString()===today.toDateString()) cls+=" current";
    html += `<div class="${cls}">${dayNum}</div>`;
  }

  // –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
  for(let d=1; d<=daysInMonth; d++){
    const date = new Date(year, month-1, d);
    let cls="calendar-day";
    if(sprint && date>=formatDate(sprint.start) && date<=formatDate(sprint.end)) cls+=" sprint";
    if(date.toDateString()===today.toDateString()) cls+=" current";
    html += `<div class="${cls}">${d}</div>`;
  }

  // –°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
  const totalCells = firstDayIndex + daysInMonth;
  const nextDays = (7 - (totalCells % 7)) % 7;
  for(let i=1;i<=nextDays;i++){
    const date = new Date(year, month, i);
    let cls="calendar-day nextMonth";
    if(sprint && date>=formatDate(sprint.start) && date<=formatDate(sprint.end)) cls+=" sprint";
    if(date.toDateString()===today.toDateString()) cls+=" current";
    html += `<div class="${cls}">${i}</div>`;
  }

  html+="</div>";
  calendarEl.innerHTML = html;
}

function renderSprints(){
  let defaultSprint=null;
  sprintContainer.innerHTML = '';
  sprints.forEach(sprint=>{
    const card=document.createElement("div"); card.className="sprint-card";
    const status=getSprintStatus(sprint);
    card.innerHTML=`<div><div class="num">–°–ø—Ä–∏–Ω—Ç ${sprint.num}</div><div class="dates">${sprint.start} ‚Äî ${sprint.end}</div></div><div class="status ${status}">${status==="completed"?"–ó–∞–≤–µ—Ä—à—ë–Ω":status==="active"?"–ê–∫—Ç–∏–≤–Ω—ã–π":"–ë—É–¥—É—â–∏–π"}</div>`;
    if(status==="active") defaultSprint=sprint;
    card.addEventListener('click',()=>{
      document.querySelectorAll('.sprint-card').forEach(c=>c.classList.remove('active'));
      card.classList.add('active');
      selectedSprint=sprint;
      const sprintStart=formatDate(sprint.start);
      const sprintMonth=sprintStart.getMonth()+1;
      const monthIndex=months.findIndex(({month, year}) => month===sprintMonth && year===sprintStart.getFullYear());
      if(monthIndex>=0) currentMonthIndex=monthIndex;
      createCalendar(selectedSprint);
    });
    sprintContainer.appendChild(card);
  });

  if(defaultSprint){
    const defaultCard = Array.from(sprintContainer.children).find(c=>c.querySelector('.num').textContent.includes(defaultSprint.num));
    if(defaultCard){
      defaultCard.classList.add('active');
      selectedSprint=defaultSprint;
      const sprintStart=formatDate(defaultSprint.start);
      const sprintMonth=sprintStart.getMonth()+1;
      const monthIndex=months.findIndex(({month, year}) => month===sprintMonth && year===sprintStart.getFullYear());
      if(monthIndex>=0) currentMonthIndex=monthIndex;
      createCalendar(selectedSprint);
    }
  } else createCalendar();
}

document.getElementById('prevMonth').addEventListener('click',()=>{ if(currentMonthIndex>0) currentMonthIndex--; createCalendar(selectedSprint); });
document.getElementById('nextMonth').addEventListener('click',()=>{ if(currentMonthIndex<months.length-1) currentMonthIndex++; createCalendar(selectedSprint); });

renderSprints();
</script>




<!-- FOOTER -->
<div style="text-align:center; font-size:14px; color:#86868b; padding:40px; background:transparent;">
  Sminex.tech ‚Äî –ø—Ä–æ–µ–∫—Ç –ò–¢ –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ Sminex<br>
  –ö–æ–Ω—Ç–∞–∫—Ç—ã: 
  <a href="https://u.vk.sminex.com/profile/nagimov@sminex.com" target="_blank" rel="noopener noreferrer" style="color:#007AFF; text-decoration:none;">
    –ù–∞–≥–∏–º–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä
  </a>
</div>

<!-- üî∂ –ú–∏–Ω–∏-–±–∞–Ω–Ω–µ—Ä –•–∞–±—Ä -->
<div
  id="habrBanner"
  class="stech-habr-banner"
  role="complementary"
  aria-label="–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç–∞—Ç—å–∏ Sminex.tech –Ω–∞ –•–∞–±—Ä–µ"
>
  <div class="stech-habr-indicator" aria-hidden="true"></div>

  <button
    id="closeHabrBanner"
    type="button"
    class="stech-habr-close"
    aria-label="–ó–∞–∫—Ä—ã—Ç—å –±–∞–Ω–Ω–µ—Ä"
  >√ó</button>

  <a
    class="stech-habr-link"
    href="https://habr.com/ru/companies/sminex/"
    target="_blank"
    rel="noopener noreferrer"
  >
    –ú—ã –Ω–∞ –•–∞–±—Ä–µ!<br>–ß–∏—Ç–∞–π—Ç–µ —Å—Ç–∞—Ç—å–∏ Sminex.tech
  </a>
</div>

<style>
  @keyframes habrBlink {
    0%, 50%, 100% { opacity: 1; }
    25%, 75% { opacity: 0.2; }
  }

  #stech-root .stech-habr-banner {
    position: fixed;
    bottom: -180px;
    right: 20px;
    background: linear-gradient(135deg, #ff7a00, #ffbb33);
    color: white;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    width: 260px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    font-size: 15px;
    z-index: 9999;
    transition: bottom 0.8s ease, opacity 0.8s ease;
    opacity: 0;
    cursor: pointer;
  }

  #stech-root .stech-habr-banner.is-visible {
    bottom: 20px;
    opacity: 1;
  }

  #stech-root .stech-habr-indicator {
    width: 10px;
    height: 10px;
    background: white;
    border-radius: 50%;
    animation: habrBlink 1s infinite;
    position: absolute;
    top: 10px;
    left: 10px;
    box-shadow: 0 0 6px white;
  }

  #stech-root .stech-habr-close {
    background: rgba(255,255,255,0.25);
    color: white;
    border: none;
    border-radius: 50%;
    width: 26px;
    height: 26px;
    font-size: 18px;
    cursor: pointer;
    align-self: flex-end;
    transition: background 0.3s;
  }

  #stech-root .stech-habr-close:hover,
  #stech-root .stech-habr-banner:focus-visible .stech-habr-close {
    background: rgba(255,255,255,0.35);
  }

  #stech-root .stech-habr-link {
    color: white;
    text-decoration: none;
    font-weight: 600;
    z-index: 1;
    line-height: 1.4;
  }
</style>

<script>
  (function initStechHabrBanner() {
    const root = document.getElementById('stech-root');
    if (!root) return;

    const banner = root.querySelector('#habrBanner');
    const closeBtn = root.querySelector('#closeHabrBanner');
    if (!banner || !closeBtn) return;

    const showBanner = () => banner.classList.add('is-visible');
    const hideBanner = () => banner.classList.remove('is-visible');

    const timerId = window.setTimeout(showBanner, 10000);

    closeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      hideBanner();
      window.clearTimeout(timerId);
    });

    banner.addEventListener('click', () => {
      window.open('https://habr.com/ru/companies/sminex_developer/articles/', '_blank');
    });
  })();
</script>


<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —è–∑—ã—á–∫–∞ –∏ –ø–ª–µ–µ—Ä–∞ -->
<div class="stech-podcast-container">

  <!-- –Ø–∑—ã—á–æ–∫ –≤—Å–µ–≥–¥–∞ –≤–∏–¥–µ–Ω -->
  <div id="podcast-tab" class="stech-podcast-tab">
    –ü–æ–¥–∫–∞—Å—Ç –ë–µ—Ç–æ–Ω –∏ –¶–∏—Ñ—Ä–∞
  </div>

  <!-- –ü–ª–µ–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç –∑–∞ —ç–∫—Ä–∞–Ω–æ–º -->
  <div id="podcast-expand" class="stech-podcast-expand" aria-hidden="true">
    <div class="stech-podcast-header">
      <div>
        <strong>–ë–µ—Ç–æ–Ω –∏ –¶–∏—Ñ—Ä–∞</strong><br>
        <span>—Å –ü–∞–≤–ª–æ–º –û—Å–∏–ø–æ–≤—ã–º</span>
      </div>
      <button id="podcast-close" class="stech-podcast-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å –ø–æ–¥–∫–∞—Å—Ç">√ó</button>
    </div>
    <div id="vk_podcast_top_right_-233288255_456239020" class="stech-podcast-widget"></div>
  </div>
</div>

<style>
  #stech-root .stech-podcast-container {
    position: fixed;
    top: 120px;
    right: 0;
    z-index: 999;
  }

  #stech-root .stech-podcast-tab {
    width: 40px;
    height: 220px;
    background: #007AFF;
    border-radius: 16px 0 0 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    font-size: 12px;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    text-align: center;
    position: relative;
    z-index: 1000;
    letter-spacing: 0.4px;
  }

  #stech-root .stech-podcast-expand {
    position: fixed;
    top: 120px;
    right: -260px;
    width: 260px;
    height: 200px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.2);
    padding: 12px;
    overflow: hidden;
    transition: right 0.3s ease;
    z-index: 999;
    box-sizing: border-box;
  }

  #stech-root .stech-podcast-expand.is-open {
    right: 60px;
  }

  #stech-root .stech-podcast-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
    gap: 8px;
  }

  #stech-root .stech-podcast-header strong {
    font-size: 14px;
    color: #1d1d1f;
  }

  #stech-root .stech-podcast-header span {
    font-size: 12px;
    color: #6e6e73;
  }

  #stech-root .stech-podcast-close {
    background: transparent;
    border: none;
    font-size: 18px;
    cursor: pointer;
    color: #1d1d1f;
    line-height: 1;
    padding: 4px;
  }

  #stech-root .stech-podcast-widget {
    width: 100%;
    height: 120px;
  }
</style>

<script src="https://vk.com/js/api/openapi.js?173"></script>
<script>
  (function initStechPodcast() {
    const root = document.getElementById('stech-root');
    if (!root) return;

    const tab = root.querySelector('#podcast-tab');
    const expand = root.querySelector('#podcast-expand');
    const closeBtn = root.querySelector('#podcast-close');
    if (!tab || !expand || !closeBtn) return;

    const toggleExpand = () => {
      const isOpen = expand.classList.toggle('is-open');
      expand.setAttribute('aria-hidden', String(!isOpen));
    };

    const hideExpand = () => {
      expand.classList.remove('is-open');
      expand.setAttribute('aria-hidden', 'true');
    };

    tab.addEventListener('click', toggleExpand);
    closeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      hideExpand();
    });

    const initPodcast = () => {
      if (window.VK && window.VK.Widgets && typeof window.VK.Widgets.Podcast === 'function') {
        window.VK.Widgets.Podcast(
          'vk_podcast_top_right_-233288255_456239020',
          '-233288255_456239020',
          'b75a82d07d7c1ba701'
        );
      }
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initPodcast, { once: true });
    } else {
      initPodcast();
    }
  })();
</script>

</div>


